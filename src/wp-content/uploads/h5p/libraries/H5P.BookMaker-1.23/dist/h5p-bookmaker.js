!function(){var e={596:function(e){e.exports=function(e,t){this.index=e,this.parent=t}},485:function(e,t,n){const r=n(596),i=H5P.EventDispatcher;function o(e,t){const n=this;i.call(n),n.children=[];var o=function(e){for(let t=e;t<n.children.length;t++)n.children[t].index=t};if(n.addChild=function(t,i){void 0===i&&(i=n.children.length);const a=new r(i,n);return i===n.children.length?n.children.push(a):(n.children.splice(i,0,a),o(i)),e.call(a,t),a},n.removeChild=function(e){n.children.splice(e,1),o(e)},n.moveChild=function(e,t){const r=n.children.splice(e,1)[0];n.children.splice(t,0,r),o(t<e?t:e)},t)for(let e=0;e<t.length;e++)n.addChild(t[e])}o.prototype=Object.create(i.prototype),o.prototype.constructor=o,e.exports=o}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=n(485),t=n.n(e),r=H5P.jQuery,i=(H5P.EventDispatcher,H5P.JoubelUI,function(e){return"function"==typeof e}),o=(navigator.userAgent.match(/iPad/i),null!==navigator.userAgent.match(/iPad|iPod|iPhone/i)),a=function(e,t){return-1!==e.indexOf(t)},s=function(e,t){return void 0!==e?e:t},c=13,l=27,p=32,h=function(e,t,n){e.click((function(e){t.call(n||this,e)})),e.keydown((function(e){a([c,p],e.which)&&(e.preventDefault(),t.call(n||this,e))}))},d=(r("<div>"),function e(t,n){return t&&n?t===n||t.parentNode===n?n:t.parentNode?e(t.parentNode,n):null:null}),u=function e(t){return!(!t||!t.classList)&&(!!t.classList.contains("h5p-book-maker-draggable-element")||!!t.parentNode&&e(t.parentNode))},f=function(e){var t=0;function n(){}return n.supported=function(){return"function"==typeof window.print},n.print=function(t,n,r){t.trigger("printing",{finished:!1,allScenes:r});var i=e(".h5p-scene.h5p-current"),o=i.height(),a=i.width()/670,s=e(".h5p-scene");s.css({height:o/a+"px",width:"670px",fontSize:Math.floor(100/a)+"%"});var c=n.height();n.css("height","auto"),s.toggleClass("doprint",!0===r),i.addClass("doprint"),setTimeout((function(){window.print(),s.css({height:"",width:"",fontSize:""}),n.css("height",c+"px"),t.trigger("printing",{finished:!0})}),500)},n.showDialog=function(n,r,i){var o=this,a=t++,s="h5p-book-maker-print-dialog-".concat(a,"-title"),c="h5p-book-maker-print-dialog-".concat(a,"-ingress"),l=e('<div class="h5p-popup-dialog h5p-print-dialog">\n                      <div role="dialog" aria-labelledby="'.concat(s,'" aria-describedby="').concat(c,'" tabindex="-1" class="h5p-inner">\n                        <h2 id="').concat(s,'">').concat(n.printTitle,'</h2>\n                        <div class="h5p-scroll-content"></div>\n                        <div class="h5p-close" role="button" tabindex="0" title="').concat(H5P.t("close"),'">\n                      </div>\n                    </div>')).insertAfter(r).click((function(){o.close()})).children(".h5p-inner").click((function(){return!1})).end();h(l.find(".h5p-close"),(function(){return o.close()}));var p=l.find(".h5p-scroll-content");return p.append(e("<div>",{class:"h5p-book-maker-print-ingress",id:c,html:n.printIngress})),H5P.JoubelUI.createButton({html:n.printAllScenes,class:"h5p-book-maker-print-all-scenes",click:function(){o.close(),i(!0)}}).appendTo(p),H5P.JoubelUI.createButton({html:n.printCurrentScene,class:"h5p-book-maker-print-current-scene",click:function(){o.close(),i(!1)}}).appendTo(p),this.open=function(){setTimeout((function(){l.addClass("h5p-open"),H5P.jQuery(o).trigger("dialog-opened",[l])}),1)},this.close=function(){l.removeClass("h5p-open"),setTimeout((function(){l.remove()}),200)},this.open(),l},n}(H5P.jQuery);const v=function(e){const t=e.length;return function n(){const r=Array.prototype.slice.call(arguments,0);return r.length>=t?e.apply(null,r):function(){const e=Array.prototype.slice.call(arguments,0);return n.apply(null,r.concat(e))}}},b=v((function(e,t){t.forEach(e)})),g=(v((function(e,t){return t.map(e)})),v((function(e,t){return t.filter(e)}))),m=(v((function(e,t){return t.some(e)})),v((function(e,t){return-1!=t.indexOf(e)}))),k=v((function(e,t){return g((t=>!m(t,e)),t)})),y=v(((e,t)=>t.getAttribute(e))),S=v(((e,t,n)=>n.setAttribute(e,t))),x=v(((e,t)=>t.removeAttribute(e))),w=v(((e,t)=>t.hasAttribute(e))),P=(v(((e,t,n)=>n.getAttribute(e)===t)),v(((e,t)=>{const n=y(e,t);S(e,("true"!==n).toString(),t)})),v(((e,t)=>e.appendChild(t))),v(((e,t)=>t.querySelector(e))),v(((e,t)=>{return n=t.querySelectorAll(e),Array.prototype.slice.call(n);var n})),v(((e,t)=>e.removeChild(t))),v(((e,t)=>t.classList.contains(e))),v(((e,t)=>t.classList.add(e)))),E=v(((e,t)=>t.classList.remove(e))),C=P("hidden"),T=E("hidden"),I=(v(((e,t)=>(e?T:C)(t))),v(((e,t,n)=>{n.classList[t?"add":"remove"](e)})),x("tabindex")),A=(b(I),S("tabindex","0")),M=S("tabindex","-1"),$=w("tabindex");class B{constructor(e){Object.assign(this,{listeners:{},on:function(e,t,n){const r={listener:t,scope:n};return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(r),this},fire:function(e,t){return(this.listeners[e]||[]).every((function(e){return!1!==e.listener.call(e.scope||this,t)}))},propagate:function(e,t){let n=this;e.forEach((e=>t.on(e,(t=>n.fire(e,t)))))}}),this.plugins=e||[],this.elements=[],this.negativeTabIndexAllowed=!1,this.on("nextElement",this.nextElement,this),this.on("previousElement",this.previousElement,this),this.on("firstElement",this.firstElement,this),this.on("lastElement",this.lastElement,this),this.initPlugins()}addElement(e){this.elements.push(e),this.firesEvent("addElement",e),1===this.elements.length&&this.setTabbable(e)}insertElementAt(e,t){this.elements.splice(t,0,e),this.firesEvent("addElement",e),1===this.elements.length&&this.setTabbable(e)}removeElement(e){this.elements=k([e],this.elements),$(e)&&(this.setUntabbable(e),this.elements[0]&&this.setTabbable(this.elements[0])),this.firesEvent("removeElement",e)}count(){return this.elements.length}firesEvent(e,t){const n=this.elements.indexOf(t);return this.fire(e,{element:t,index:n,elements:this.elements,oldElement:this.tabbableElement})}nextElement({index:e}){const t=e===this.elements.length-1,n=this.elements[t?0:e+1];this.setTabbable(n),n.focus()}firstElement(){const e=this.elements[0];this.setTabbable(e),e.focus()}lastElement(){const e=this.elements[this.elements.length-1];this.setTabbable(e),e.focus()}setTabbableByIndex(e){const t=this.elements[e];t&&this.setTabbable(t)}setTabbable(e){b(this.setUntabbable.bind(this),this.elements),A(e),this.tabbableElement=e}setUntabbable(e){e!==document.activeElement&&(this.negativeTabIndexAllowed?M(e):I(e))}previousElement({index:e}){const t=0===e,n=this.elements[t?this.elements.length-1:e-1];this.setTabbable(n),n.focus()}useNegativeTabIndex(){this.negativeTabIndexAllowed=!0,this.elements.forEach((e=>{e.hasAttribute("tabindex")||M(e)}))}initPlugins(){this.plugins.forEach((function(e){void 0!==e.init&&e.init(this)}),this)}}class L{constructor(){this.selectability=!0}init(e){this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.controls=e,this.controls.on("addElement",this.listenForKeyDown,this),this.controls.on("removeElement",this.removeKeyDownListener,this)}listenForKeyDown({element:e}){e.addEventListener("keydown",this.boundHandleKeyDown)}removeKeyDownListener({element:e}){e.removeEventListener("keydown",this.boundHandleKeyDown)}handleKeyDown(e){switch(e.which){case 27:this.close(e.target),e.preventDefault(),e.stopPropagation();break;case 35:this.lastElement(e.target),e.preventDefault(),e.stopPropagation();break;case 36:this.firstElement(e.target),e.preventDefault(),e.stopPropagation();break;case 13:case 32:this.select(e.target),e.preventDefault(),e.stopPropagation();break;case 37:case 38:this.hasChromevoxModifiers(e)||(this.previousElement(e.target),e.preventDefault(),e.stopPropagation());break;case 39:case 40:this.hasChromevoxModifiers(e)||(this.nextElement(e.target),e.preventDefault(),e.stopPropagation())}}hasChromevoxModifiers(e){return e.shiftKey||e.ctrlKey}previousElement(e){!1!==this.controls.firesEvent("beforePreviousElement",e)&&(this.controls.firesEvent("previousElement",e),this.controls.firesEvent("afterPreviousElement",e))}nextElement(e){!1!==this.controls.firesEvent("beforeNextElement",e)&&(this.controls.firesEvent("nextElement",e),this.controls.firesEvent("afterNextElement",e))}select(e){this.selectability&&!1!==this.controls.firesEvent("before-select",e)&&(this.controls.firesEvent("select",e),this.controls.firesEvent("after-select",e))}firstElement(e){!1!==this.controls.firesEvent("beforeFirstElement",e)&&(this.controls.firesEvent("firstElement",e),this.controls.firesEvent("afterFirstElement",e))}lastElement(e){!1!==this.controls.firesEvent("beforeLastElement",e)&&(this.controls.firesEvent("lastElement",e),this.controls.firesEvent("afterLastElement",e))}disableSelectability(){this.selectability=!1}enableSelectability(){this.selectability=!0}close(e){!1!==this.controls.firesEvent("before-close",e)&&(this.controls.firesEvent("close",e),this.controls.firesEvent("after-close",e))}}var H=function(e){function t(e){this.bookMaker=e,this.initProgressbar(),this.initFooter(),this.initTaskAnsweredListener(),this.toggleNextAndPreviousButtonDisabled(this.bookMaker.getCurrentSceneIndex())}return t.prototype.initTaskAnsweredListener=function(){var e=this;this.bookMaker.elementInstances.forEach((function(t,n){t.filter((function(e){return i(e.on)})).forEach((function(t){t.on("xAPI",(function(t){var r=t.getVerb();if(a(["interacted","answered","attempted"],r)){e.setTaskAnswered(n,!1)}else"completed"===r&&t.setVerb("answered");void 0===t.data.statement.context.extensions&&(t.data.statement.context.extensions={}),t.data.statement.context.extensions["http://id.tincanapi.com/extension/ending-point"]=n+1}))}))}))},t.prototype.initProgressbar=function(){var t=this,n=this,r=n.bookMaker.previousState&&n.bookMaker.previousState.progress||0;this.progresbarKeyboardControls=new B([new L]),this.progresbarKeyboardControls.negativeTabIndexAllowed=!0,this.progresbarKeyboardControls.on("select",(function(t){n.displayScene(e(t.element).data("sceneNumber"))})),this.progresbarKeyboardControls.on("beforeNextElement",(function(e){return e.index!==e.elements.length-1})),this.progresbarKeyboardControls.on("beforePreviousElement",(function(e){return 0!==e.index})),void 0!==this.bookMaker.progressbarParts&&this.bookMaker.progressbarParts&&this.bookMaker.progressbarParts.forEach((function(e){n.progresbarKeyboardControls.removeElement(e.children("a").get(0)),e.remove()})),n.bookMaker.progressbarParts=[];for(var i=function(t){t.preventDefault();var r=e(this).data("sceneNumber");n.progresbarKeyboardControls.setTabbableByIndex(r),n.displayScene(r),n.bookMaker.focus()},a=0;a<this.bookMaker.scenes.length;a+=1){var s=this.createSceneTitle(a),c=e("<li>",{class:"h5p-progressbar-part"}).appendTo(n.bookMaker.$progressbar),l=e("<a>",{href:"#",html:'<span class="h5p-progressbar-part-title hidden-but-read">'+s+"</span>",tabindex:"-1"}).data("sceneNumber",a).click(i).appendTo(c);this.progresbarKeyboardControls.addElement(l.get(0)),o||function(){var n=e("<div/>",{class:"h5p-progressbar-popup",html:s,"aria-hidden":"true"}).appendTo(c);c.mouseenter((function(){return t.ensurePopupVisible(n)}))}(),0===a&&c.addClass("h5p-progressbar-part-show"),a===r&&c.addClass("h5p-progressbar-part-selected"),n.bookMaker.progressbarParts.push(c),this.updateSceneTitle(a)}},t.prototype.ensurePopupVisible=function(e){var t=this.bookMaker.$container.width(),n=e.outerWidth(),r=e.offset().left;r<0?(e.css("left",0),e.css("transform","translateX(0)")):r+n>t&&(e.css("left","auto"),e.css("right",0),e.css("transform","translateX(0)"))},t.prototype.displayScene=function(e){var t=this.bookMaker.getCurrentSceneIndex();this.updateSceneTitle(e,{isCurrent:!0}),this.updateSceneTitle(t,{isCurrent:!1}),this.bookMaker.jumpToScene(e),this.toggleNextAndPreviousButtonDisabled(e)},t.prototype.createSceneTitle=function(e){return this.bookMaker.l10n.scene+" "+(e+1)},t.prototype.initFooter=function(){var t=this,n=this,r=this.bookMaker.$footer;e("<div/>",{class:"h5p-footer-left-adjusted"}).appendTo(r);var i=e("<div/>",{class:"h5p-footer-center-adjusted"}).appendTo(r),o=e("<div/>",{role:"toolbar",class:"h5p-footer-right-adjusted"}).appendTo(r);this.bookMaker.$prevSceneButton=e("<div/>",{class:"h5p-footer-button h5p-footer-previous-scene","aria-label":this.bookMaker.l10n.prevScene,title:this.bookMaker.l10n.prevScene,role:"button",tabindex:"-1","aria-disabled":"true"}).appendTo(i),h(this.bookMaker.$prevSceneButton,(function(){return t.bookMaker.previousScene()}));var a=e("<div/>",{class:"h5p-footer-scene-count"}).appendTo(i);this.bookMaker.$footerCurrentScene=e("<div/>",{html:"1",class:"h5p-footer-scene-count-current",title:this.bookMaker.l10n.currentScene,"aria-hidden":"true"}).appendTo(a),this.bookMaker.$footerCounter=e("<div/>",{class:"hidden-but-read",html:this.bookMaker.l10n.sceneCount.replace("@index","1").replace("@total",this.bookMaker.scenes.length.toString())}).appendTo(i),e("<div/>",{html:"/",class:"h5p-footer-scene-count-delimiter","aria-hidden":"true"}).appendTo(a),this.bookMaker.$footerMaxScene=e("<div/>",{html:this.bookMaker.scenes.length,class:"h5p-footer-scene-count-max",title:this.bookMaker.l10n.lastScene,"aria-hidden":"true"}).appendTo(a),this.bookMaker.$nextSceneButton=e("<div/>",{class:"h5p-footer-button h5p-footer-next-scene","aria-label":this.bookMaker.l10n.nextScene,title:this.bookMaker.l10n.nextScene,role:"button",tabindex:"0"}).appendTo(i),h(this.bookMaker.$nextSceneButton,(function(){return t.bookMaker.nextScene()})),void 0===this.bookMaker.editor&&(this.bookMaker.enablePrintButton&&f.supported()&&(this.bookMaker.$printButton=e("<div/>",{class:"h5p-footer-button h5p-footer-print","aria-label":this.bookMaker.l10n.printTitle,title:this.bookMaker.l10n.printTitle,role:"button",tabindex:"0"}).appendTo(o),h(this.bookMaker.$printButton,(function(){return n.openPrintDialog()}))),H5P.fullscreenSupported&&(this.bookMaker.$fullScreenButton=e("<div/>",{class:"h5p-footer-button h5p-footer-toggle-full-screen","aria-label":this.bookMaker.l10n.fullscreen,title:this.bookMaker.l10n.fullscreen,role:"button",tabindex:"0"}),h(this.bookMaker.$fullScreenButton,(function(){return n.bookMaker.toggleFullScreen()})),this.bookMaker.$fullScreenButton.appendTo(o)))},t.prototype.openPrintDialog=function(){var t=this,n=e(".h5p-wrapper");f.showDialog(this.bookMaker.l10n,n,(function(e){f.print(t.bookMaker,n,e)})).children('[role="dialog"]').focus()},t.prototype.updateProgressBar=function(e,t){var n,r=this;for(n=0;n<r.bookMaker.progressbarParts.length;n+=1)e+1>n?r.bookMaker.progressbarParts[n].addClass("h5p-progressbar-part-show"):r.bookMaker.progressbarParts[n].removeClass("h5p-progressbar-part-show");r.progresbarKeyboardControls.setTabbableByIndex(e),r.bookMaker.progressbarParts[e].addClass("h5p-progressbar-part-selected").siblings().removeClass("h5p-progressbar-part-selected"),void 0!==t||r.bookMaker.progressbarParts.forEach((function(e,t){r.setTaskAnswered(t,!1)}))},t.prototype.setTaskAnswered=function(e,t){this.bookMaker.progressbarParts[e].find(".h5p-progressbar-part-has-task").toggleClass("h5p-answered",t),this.updateSceneTitle(e)},t.prototype.updateSceneTitle=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.isCurrent;this.setSceneTitle(e,{isCurrent:s(n,this.bookMaker.isCurrentScene(e))})},t.prototype.setSceneTitle=function(e,t){var n=t.isCurrent,r=void 0!==n&&n,i=this.bookMaker.scenes.length,o=this.bookMaker.progressbarParts[e].find(".h5p-progressbar-part-title"),a=this.bookMaker.l10n.sceneCount.replace("@index",e+1).replace("@total",i),s=r?this.bookMaker.l10n.currentScene:"";o.html("".concat(a,": ").concat(s))},t.prototype.updateFooter=function(e){this.bookMaker.$footerCurrentScene.html(e+1),this.bookMaker.$footerMaxScene.html(this.bookMaker.scenes.length),this.bookMaker.$footerCounter.html(this.bookMaker.l10n.sceneCount.replace("@index",(e+1).toString()).replace("@total",this.bookMaker.scenes.length.toString())),this.toggleNextAndPreviousButtonDisabled(e)},t.prototype.toggleNextAndPreviousButtonDisabled=function(e){var t=this.bookMaker.scenes.length-1;this.bookMaker.$prevSceneButton.attr("aria-disabled",(0===e).toString()),this.bookMaker.$nextSceneButton.attr("aria-disabled",(e===t).toString()),this.bookMaker.$prevSceneButton.attr("tabindex",0===e?"-1":"0"),this.bookMaker.$nextSceneButton.attr("tabindex",e===t?"-1":"0")},t}(H5P.jQuery);function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};D(this,e),this.params=t||{},this.params.position=t.position||"left",this.params.prefix=t.prefix||"",this.params.label=this.params.label||"Move",this.callbacks=r,this.callbacks.onClick=r.onClick||function(){},this.navigationBar=document.createElement("div"),this.navigationBar.setAttribute("role","button"),this.navigationBar.setAttribute("tabIndex",0),this.navigationBar.setAttribute("aria-label",this.params.label),this.navigationBar.classList.add("".concat(this.params.prefix,"-navigation-bar")),this.navigationBar.classList.add("".concat(this.params.prefix,"-navigation-bar-").concat(this.params.position));var i=document.createElement("div");i.classList.add("".concat(this.params.prefix,"-navigation-bar-background")),this.navigationBar.appendChild(i),this.navigationBar.addEventListener("click",(function(){n.callbacks.onClick()})),this.navigationBar.addEventListener("keypress",(function(){n.callbacks.onClick()}))}var t,n,r;return t=e,(n=[{key:"getDOM",value:function(){return this.navigationBar}},{key:"show",value:function(){this.navigationBar.classList.add("".concat(this.params.prefix,"-navigation-bar-visible"))}},{key:"hide",value:function(){this.navigationBar.classList.remove("".concat(this.params.prefix,"-navigation-bar-visible"))}}])&&N(t.prototype,n),r&&N(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t,n){return t&&j(e.prototype,t),n&&j(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var F=O((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.book;n=r.extend(!0,{globalBackgroundSelector:{fillGlobalBackground:"",imageGlobalBackground:{}},scenes:[{sceneBackgroundSelector:{fill:"",image:{}}}]},n);var i,o=function(e,n,r){var i=t.$scenesWrapper.children();void 0!==r&&(i=i.eq(r)),e&&""!==e?i.addClass("has-background").css("background-image","").css("background-color",e):n&&n.path&&i.addClass("has-background").css("background-color","").css("background-image","url("+H5P.getPath(n.path,t.contentId)+")")};i=n.globalBackgroundSelector,o(i.fillGlobalBackground,i.imageGlobalBackground),n.scenes.forEach((function(e,t){var n=e.sceneBackgroundSelector;n&&o(n.fill,n.image,t)}))}));var z=function(e){var t,n=this;(t=n.parent.parent.isEditor()?H5P.jQuery.extend(!0,{},e.action,n.parent.parent.elementsOverride):H5P.jQuery.extend(!0,e.action,n.parent.parent.elementsOverride)).params.autoplay?(t.params.autoplay=!1,t.params.bookMakerAutoplay=!0):t.params.playback&&t.params.playback.autoplay?(t.params.playback.autoplay=!1,t.params.bookMakerAutoplay=!0):t.params.media&&t.params.media.params&&t.params.media.params.playback&&t.params.media.params.playback.autoplay?(t.params.media.params.playback.autoplay=!1,t.params.bookMakerAutoplay=!0):t.params.media&&t.params.media.params&&t.params.media.params.autoplay?(t.params.media.params.autoplay=!1,t.params.bookMakerAutoplay=!0):t.params.override&&t.params.override.autoplay&&(t.params.override.autoplay=!1,t.params.bookMakerAutoplay=!0);var r=n.parent.parent.elementInstances[n.parent.index]?n.parent.parent.elementInstances[n.parent.index].length:0;if(n.parent.parent.previousState&&n.parent.parent.previousState.answers&&n.parent.parent.previousState.answers[n.parent.index]&&n.parent.parent.previousState.answers[n.parent.index][r]&&(t.userDatas={state:n.parent.parent.previousState.answers[n.parent.index][r]}),t.params=t.params||{},n.instance=H5P.newRunnable(t,n.parent.parent.contentId,void 0,!0,{parent:n.parent.parent}),void 0!==n.instance.preventResize&&(n.instance.preventResize=!0),void 0===n.parent.parent.elementInstances[n.parent.index]?n.parent.parent.elementInstances[n.parent.index]=[n.instance]:n.parent.parent.elementInstances[n.parent.index].push(n.instance),"H5P.Audio"===t.library.split(" ")[0]&&e.canBeChangedByUser&&n.parent.parent.audioReferences.push({instance:n.instance,id:n.parent.parent.audioReferences.length+1}),"H5P.AudioRecorderBookMaker"===t.library.split(" ")[0]){var i=n.parent.parent.audioReferences.shift();n.instance.bookmakerReferenceId=i.id,n.instance.on("recordingdone",(function(e){e.data.id===i.id&&(i.instance.audio.src=e.data.url,i.instance.audio.load(),document.querySelector(".h5p-close-popup").click())}))}};function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function U(e){var n,r=this;r.paperCorners={left:{element:{attentionSeeker:K({},e.attentionSeeker)}},right:{element:{attentionSeeker:K({},e.attentionSeeker)}}},t().call(r,z,e.elements),r.getElement=function(){return n||(n=H5P.jQuery(U.createHTML(e))),r.parent.isEditor()||(r.index>0&&(r.paperCorners.left.dom=document.createElement("div"),r.paperCorners.left.dom.classList.add("h5p-book-maker-paper"),r.paperCorners.left.dom.classList.add("h5p-book-maker-left"),n.append(r.paperCorners.left.dom)),r.index<r.parent.getChildren().length-1&&(r.paperCorners.right.dom=document.createElement("div"),r.paperCorners.right.dom.classList.add("h5p-book-maker-paper"),r.paperCorners.right.dom.classList.add("h5p-book-maker-right"),n.append(r.paperCorners.right.dom))),n},r.getCorner=function(e){if("left"===e||"right"===e)return r.paperCorners[e]},r.getCorners=function(){return r.paperCorners},r.setCurrent=function(){this.parent.$current=n.addClass("h5p-current")},r.appendElements=function(){for(var t=0;t<r.children.length;t++)r.parent.attachElement(e.elements[t],r.children[t].instance,n,r.index);r.parent.elementsAttached[r.index]=!0,r.parent.trigger("domChanged",{$target:n,library:"BookMaker",key:"newScene"},{bubbles:!0,external:!0})}}U.createHTML=function(e){return'<div role="document" class="h5p-scene"'+(void 0!==e.background?' style="background:'+e.background+'"':"")+"></div>"};var Q=U,q=function(e,n,i){var o=this,a=this;this.book=e.book,this.scenes=this.book.scenes,this.contentId=n,this.elementInstances=[],this.elementsAttached=[],this.hasAnswerElements=!1,this.ignoreResize=!1,this.attentionSeeker=new H5P.AttentionSeeker,i.bookMakerEditor&&(this.editor=i.bookMakerEditor),this.audioReferences=[],this.editor?this.editor.on("removeScene",(function(e){o.$scenesWrapper.children().eq(e.data).remove()})):e.book.scenes.forEach((function(e){e.elements&&e.elements.forEach((function(t){var n=t.action&&t.action.library?t.action.library.split(" ")[0]:null;if(n&&"H5P.Audio"===n&&t.canBeChangedByUser){var r={backgroundOpacity:0,displayAsButton:!0,height:8.88887,width:5,x:t.x+t.width-2.5,y:t.y-4.444435,action:{library:"H5P.AudioRecorderBookMaker 1.0",metadata:{contentType:"AudioRecorderBookMaker",license:"U",title:"Untitled Audio Recorder"},params:{l10n:{recordAnswer:"Record",pause:"Pause",continue:"Continue",download:"Use",done:"Done",retry:"Retry",microphoneNotSupported:"Microphone not supported. Make sure you are using a browser that allows microphone recording.",microphoneInaccessible:"Microphone is not accessible. Make sure that the browser microphone is enabled.",insecureNotAllowed:"Access to microphone is not allowed in your browser since this page is not served using HTTPS. Please contact the author, and ask him to make this available using HTTPS",statusReadyToRecord:"Press a button below to record your answer.",statusRecording:"Recording...",statusPaused:"Recording paused. Press a button to continue recording.",statusFinishedRecording:"You have successfully recorded your answer! Listen to the recording below.",downloadRecording:"Download this recording or retry.",retryDialogHeaderText:"Retry recording?",retryDialogBodyText:'By pressing "Retry" you will lose your current recording.',retryDialogConfirmText:"Retry",retryDialogCancelText:"Cancel",statusCantCreateTheAudioFile:"Can't create the audio file."}},subContentId:H5P.createUUID()}};e.elements=e.elements.concat(r)}}))})),i&&(this.previousState=i.previousState),this.currentSceneIndex=this.previousState&&this.previousState.progress?this.previousState.progress:0,this.l10n=r.extend({scene:"Scene",retry:"Retry",close:"Close",fullscreen:"Fullscreen",exitFullscreen:"Exit fullscreen",prevScene:"Previous scene",nextScene:"Next scene",currentScene:"Current scene",lastScene:"Last scene",printTitle:"Print",printIngress:"How would you like to print this presentation?",printAllScenes:"Print all scenes",printCurrentScene:"Print current scene",noTitle:"No title",accessibilitySceneNavigationExplanation:"Use left and right arrow to change scene in that direction whenever canvas is selected.",sceneCount:"Scene @index of @total",accessibilityCanvasLabel:"Presentation canvas. Use left and right arrow to move between scenes."},void 0!==e.l10n?e.l10n:{}),e.override&&(this.enablePrintButton=!!e.override.enablePrintButton),this.players=[],this.setElementsOverride(e.override),e.book.scenes.forEach((function(t){t.attentionSeeker=e.override&&e.override.attentionSeekerCorner})),t().call(this,Q,e.book.scenes),this.on("resize",this.resize,this),this.on("printing",(function(e){a.ignoreResize=!e.data.finished,e.data.finished?a.resize():e.data.allScenes&&a.attachAllElements()}))};(q.prototype=Object.create(t().prototype)).constructor=q,q.prototype.attach=function(e){var t=this,n=this;void 0!==this.isRoot&&this.isRoot()&&this.setActivityStarted();var r='<div class="h5p-keymap-explanation hidden-but-read">'+this.l10n.accessibilitySceneNavigationExplanation+'</div><div class="h5p-fullscreen-announcer hidden-but-read" aria-live="polite"></div><div class="h5p-wrapper" tabindex="0" aria-label="'+this.l10n.accessibilityCanvasLabel+'">  <div class="h5p-current-scene-announcer hidden-but-read" aria-live="polite"></div>  <div tabindex="-1"></div>  <div class="h5p-box-wrapper">    <div class="h5p-presentation-wrapper">     <div class="h5p-scenes-wrapper"></div>    </div>  </div>  <nav class="h5p-book-maker-navigation">    <ol class="h5p-progressbar list-unstyled"></ol>  </nav>  <div class="h5p-footer"></div></div>';e.attr("role","application").addClass("h5p-book-maker").html(r),this.$container=e,this.$sceneAnnouncer=e.find(".h5p-current-scene-announcer"),this.$fullscreenAnnouncer=e.find(".h5p-fullscreen-announcer"),this.$sceneTop=this.$sceneAnnouncer.next(),this.$wrapper=e.children(".h5p-wrapper").focus((function(){n.initKeyEvents()})).blur((function(){void 0!==n.keydown&&(H5P.jQuery("body").unbind("keydown",n.keydown),delete n.keydown)})).click((function(e){var t=H5P.jQuery(e.target),r=n.belongsToTagName(e.target,["input","textarea","a","button"],e.currentTarget),i=n.belongsToTabIndexed(e.target),o=t.closest(".h5p-popup-container"),a=0!==o.length;if(!r&&!i&&!n.editor)if(a){var s=t.closest("[tabindex]");1===s.closest(".h5p-popup-container").length?s.focus():o.find(".h5p-close-popup").focus()}else n.$wrapper.focus()})),this.on("exitFullScreen",(function(){t.$footer.removeClass("footer-full-screen"),t.$fullScreenButton.attr("title",t.l10n.fullscreen),t.$fullscreenAnnouncer.html(t.l10n.accessibilityExitedFullscreen)})),this.on("enterFullScreen",(function(){t.$fullscreenAnnouncer.html(t.l10n.accessibilityEnteredFullscreen)}));var i=parseInt(this.$wrapper.css("width"));this.width=0!==i?i:640;var o=parseInt(this.$wrapper.css("height"));this.height=0!==o?o:400,this.ratio=16/9,this.fontSize=16,this.$boxWrapper=this.$wrapper.children(".h5p-box-wrapper");var a=this.$boxWrapper.children(".h5p-presentation-wrapper");this.$scenesWrapper=a.children(".h5p-scenes-wrapper"),this.$progressbar=this.$wrapper.find(".h5p-progressbar"),this.$footer=this.$wrapper.children(".h5p-footer"),this.createScenes(),this.elementsAttached[this.currentSceneIndex]=!0,this.runAttentionSeekers(this.getCurrentSceneIndex()),this.initTouchEvents(),this.navigationLine=new H(this),this.previousState&&this.previousState.progress||this.setSceneNumberAnnouncer(0,!1),this.isEditor()||(this.createNavigationBars(),this.createFullScreenButton(),this.$wrapper.find(".h5p-book-maker-navigation").hide(),this.$footer.hide()),new F(this),this.previousState&&this.previousState.progress&&this.jumpToScene(this.previousState.progress),setTimeout((function(){t.resize()}),100)},q.prototype.belongsToTagName=function(e,t,n){if(!e)return!1;n=n||document.body,"string"==typeof t&&(t=[t]),t=t.map((function(e){return e.toLowerCase()}));var r=e.tagName.toLowerCase();return-1!==t.indexOf(r)||n!==e&&this.belongsToTagName(e.parentNode,t,n)},q.prototype.belongsToTabIndexed=function(e,t){return!!e&&(t=t||document.body,-1!==e.tabIndex||t!==e&&this.belongsToTabIndexed(e.parentNode,t))},q.prototype.createSceneTitle=function(){return this.isEditor()?this.l10n.noTitle:null},q.prototype.isEditor=function(){return void 0!==this.editor},q.prototype.createNavigationBars=function(){var e=this;this.navigationLeft=new R({label:this.l10n.prevScene,position:"left",prefix:"h5p-book-maker"},{onClick:function(){if(0!==e.currentSceneIndex){var t=e.children[e.getCurrentSceneIndex()].getCorner("left").dom;t&&t.click(),e.previousScene()}}}),this.$wrapper.append(this.navigationLeft.getDOM()),this.navigationRight=new R({label:this.l10n.nextScene,position:"right",prefix:"h5p-book-maker"},{onClick:function(){if(!(e.currentSceneIndex+1>=e.children.length)){var t=e.children[e.getCurrentSceneIndex()].getCorner("right").dom;t&&t.click(),e.nextScene()}}}),this.navigationRight.show(),this.$wrapper.append(this.navigationRight.getDOM())},q.prototype.createFullScreenButton=function(){var e=this;if(!0===H5P.fullscreenSupported){var t=document.querySelector(".h5p-container");this.fullScreenButton=document.createElement("button"),this.fullScreenButton.classList.add("h5p-book-maker-fullscreen-button"),this.fullScreenButton.setAttribute("aria-label",this.l10n.fullscreen),this.fullScreenButton.addEventListener("click",(function(n){n&&"keypress"===n.type&&13!==n.keyCode&&32!==n.keyCode||(n.preventDefault(),!0===H5P.isFullscreen?H5P.exitFullScreen():H5P.fullScreen(H5P.jQuery(t),e))})),this.on("enterFullScreen",(function(){e.fullScreenButton.setAttribute("aria-label",e.l10n.exitFullscreen)})),this.on("exitFullScreen",(function(){e.fullScreenButton.setAttribute("aria-label",e.l10n.fullscreen)}));var n=document.createElement("div");n.classList.add("h5p-book-maker-fullscreen-button-wrapper"),n.appendChild(this.fullScreenButton),t.insertBefore(n,t.firstChild)}},q.prototype.createScenes=function(){for(var e=this,t=0;t<e.children.length;t++){var n=t===e.currentSceneIndex;e.children[t].getElement().appendTo(e.$scenesWrapper),n&&e.children[t].setCurrent(),(e.isEditor()||0===t||1===t||n)&&e.children[t].appendElements()}},q.prototype.getScore=function(){return 0},q.prototype.getMaxScore=function(){return 0},q.prototype.resize=function(){var e=this.$container.hasClass("h5p-fullscreen")||this.$container.hasClass("h5p-semi-fullscreen");if(!this.ignoreResize){this.$wrapper.css("width","auto");var t=this.$container.width(),n={};if(e){var r=this.$container.height();t/r>this.ratio&&(t=r*this.ratio,n.width=t+"px")}var i=t/this.width;n.height=t/this.ratio+"px",n.fontSize=this.fontSize*i+"px",void 0!==this.editor&&this.editor.setContainerEm(this.fontSize*i*.75),this.$wrapper.css(n),this.swipeThreshold=100*i;var o=this.elementInstances[this.$current.index()];if(void 0!==o)for(var a=0;a<o.length;a++){var s=o[a];void 0!==s.preventResize&&!1!==s.preventResize||void 0===s.$||H5P.trigger(s,"resize")}}},q.prototype.toggleFullScreen=function(){H5P.isFullscreen||this.$container.hasClass("h5p-fullscreen")||this.$container.hasClass("h5p-semi-fullscreen")?void 0!==H5P.exitFullScreen&&void 0!==H5P.fullScreenBrowserPrefix?H5P.exitFullScreen():void 0===H5P.fullScreenBrowserPrefix?H5P.jQuery(".h5p-disable-fullscreen").click():""===H5P.fullScreenBrowserPrefix?window.top.document.exitFullScreen():"ms"===H5P.fullScreenBrowserPrefix?window.top.document.msExitFullscreen():window.top.document[H5P.fullScreenBrowserPrefix+"CancelFullScreen"]():(this.$footer.addClass("footer-full-screen"),this.$fullScreenButton.attr("title",this.l10n.exitFullscreen),H5P.fullScreen(this.$container,this),void 0===H5P.fullScreenBrowserPrefix&&H5P.jQuery(".h5p-disable-fullscreen").hide())},q.prototype.focus=function(){this.$wrapper.focus()},q.prototype.setElementsOverride=function(e){this.elementsOverride={params:{}},e&&(this.elementsOverride.params.behaviour={},e.retryButton&&(this.elementsOverride.params.behaviour.enableRetry="on"===e.retryButton))},q.prototype.attachElements=function(e,t){if(void 0===this.elementsAttached[t]){var n=this.scenes[t],r=this.elementInstances[t];if(void 0!==n.elements)for(var i=0;i<n.elements.length;i++)this.attachElement(n.elements[i],r[i],e,t);this.trigger("domChanged",{$target:e,library:"BookMaker",key:"newScene"},{bubbles:!0,external:!0}),this.elementsAttached[t]=!0}},q.prototype.addAttentionSeeker=function(e,t){var n=this;if(t.attentionSeeker.style&&"none"!==t.attentionSeeker.style){t.attentionSeeker.workerId=this.attentionSeeker.register({element:e,style:t.attentionSeeker.style,interval:1e3*(t.attentionSeeker.interval||10),repeat:t.attentionSeeker.repeat||1/0});var r=function(){n.attentionSeeker.unregister(t.attentionSeeker.workerId)};e.addEventListener("click",r,t.attentionSeeker.workerId),e.addEventListener("mousedown",r,t.attentionSeeker.workerId),e.addEventListener("touchstart",r,t.attentionSeeker.workerId),this.attentionSeeker.on("removed",(function(n){n.data===t.attentionSeeker.workerId&&(t.attentionSeeker.workerId=q.ATTENTION_SEEKER_DONE,e.removeEventListener("click",r),e.removeEventListener("mousedown",r),e.removeEventListener("touchstart",r))}))}},q.prototype.runAttentionSeeker=function(e,t){if(t.attentionSeeker)if("number"!=typeof t.attentionSeeker.workerId)t.attentionSeeker.style&&"none"!==t.attentionSeeker.style&&(this.addAttentionSeeker(e,t),this.attentionSeeker.run(t.attentionSeeker.workerId));else{if(t.attentionSeeker.workerId<0)return;this.attentionSeeker.run(t.attentionSeeker.workerId)}},q.prototype.runAttentionSeekers=function(e){var t=this;if(!this.isEditor()&&e===this.getCurrentSceneIndex())for(var n in this.$current[0].querySelectorAll(".h5p-element").forEach((function(n,r){t.runAttentionSeeker(n,t.scenes[e].elements[r])})),this.children[e].getCorners()){var r=this.children[e].getCorners();r[n].dom&&this.runAttentionSeeker(r[n].dom,r[n].element)}},q.prototype.pauseAttentionSeeker=function(e){e&&e.attentionSeeker&&("number"!=typeof e.attentionSeeker.workerId||e.attentionSeeker.workerId<0||this.attentionSeeker.pause(e.attentionSeeker.workerId))},q.prototype.pauseAttentionSeekers=function(e){var t=this;if(!this.isEditor())for(var n in this.scenes[e].elements.forEach((function(e){t.pauseAttentionSeeker(e)})),this.children[e].getCorners()){var r=this.children[e].getCorners();this.pauseAttentionSeeker(r[n].element)}},q.prototype.attachElement=function(e,t,n,r){var i=this,o=void 0!==e.displayAsButton&&e.displayAsButton,a="h5p-element"+(o?" h5p-element-button-wrapper h5p-element-button-big":""),s=H5P.jQuery("<div>",{class:a}).css({left:e.x+"%",top:e.y+"%",width:e.width+"%",height:e.height+"%"}).appendTo(n),c=void 0===e.backgroundOpacity||0===e.backgroundOpacity;if(s.toggleClass("h5p-transparent",c),o){this.createInteractionButton(e,t).appendTo(s)}else{var l=e.action&&e.action.library?this.getLibraryTypePmz(e.action.library):"other",p=H5P.jQuery("<div>",{class:"h5p-element-outer ".concat(l,"-outer-element")}).css({background:"rgba(255,255,255,"+(void 0===e.backgroundOpacity?0:e.backgroundOpacity/100)+")"}).appendTo(s),h=H5P.jQuery("<div>",{class:"h5p-element-inner"}).appendTo(p);t.on("set-size",(function(e){for(var t in e.data)s.get(0).style[t]=e.data[t]})),t.attach(h),this.setOverflowTabIndex()}if(void 0!==this.editor&&this.editor.processElement(e,s,r,t),e.action&&e.action.library&&"H5P.Audio"===e.action.library.split(" ")[0]){var d=h.get(0).querySelector("button");if(d&&e.customImagePlay&&e.customImagePlay.path){d.classList.add("h5p-book-maker-custom-audio-button");var u=document.createElement("img");u.classList.add("h5p-book-maker-custom-audio-button-image"),u.classList.add("h5p-book-maker-selection-not-allowed"),u.setAttribute("draggable",!1),H5P.setSource(u,e.customImagePlay,this.contentId),d.appendChild(u),t.audio.addEventListener("ended",(function(){H5P.setSource(u,e.customImagePlay,i.contentId)})),e.customImagePlayPaused&&e.customImagePlayPaused.path&&t.audio.addEventListener("pause",(function(){H5P.setSource(u,e.customImagePlayPaused,i.contentId)})),e.customImagePause&&e.customImagePause.path&&t.audio.addEventListener("play",(function(){H5P.setSource(u,e.customImagePause,i.contentId)}))}}if(!this.editor&&e.action&&e.action.library&&"H5P.Image"===e.action.library.split(" ")[0]){var f=s.get(0);if(f.classList.add("h5p-book-maker-selection-not-allowed"),e.canBeMovedByUser)f.classList.add("h5p-book-maker-draggable-element"),this.addElementMoveListeners(f,e.audio);else{var v=f.querySelector("img");v&&v.setAttribute("draggable",!1)}}if(!this.editor&&e.action&&e.action.library&&"H5P.AdvancedText"===e.action.library.split(" ")[0]&&e.canBeChangedByUser){var b=s.get(0);b.classList.add("h5p-book-maker-no-overflow"),b.setAttribute("contenteditable","true"),b.setAttribute("role","input"),b.addEventListener("click",(function(e){var t=document.querySelector(".h5p-content");t&&t.classList.remove("using-mouse"),e.currentTarget.focus()}))}return this.kidsloopPreventDragging(t),s},q.prototype.addElementMoveListeners=function(e){var t,n,r,i,o=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e.parentNode,c={},l=!1,p=0,h=0;["pickedUp","dropped"].forEach((function(e){if(a[e]&&Array.isArray(a[e])&&!(a[e].length<1)&&a[e][0].path&&"audio"===a[e][0].mime.split("/")[0]){var t=document.createElement("audio");t.classList.add("h5p-dragquestion-no-display"),t.src=H5P.getPath(a[e][0].path,o.contentId),s.appendChild(t),o.players.push(t),c[e]=t}}));var u=function(a){t=0,n=0;var s=d(a.target,e);if(s){o.isEditor()||(o.navigationLeft.hide(),o.navigationRight.hide()),"touchstart"===a.type?(r=a.touches[0].clientX-p,i=a.touches[0].clientY-h):(r=a.clientX-p,i=a.clientY-h);for(var u=document.querySelector(".h5p-scene.h5p-current").querySelectorAll(".h5p-book-maker-draggable-element"),f=0;f<u.length;f++)u[f].classList.remove("h5p-book-maker-draggable-element-top");s.classList.add("h5p-book-maker-draggable-element-top"),s.classList.add("h5p-book-maker-draggable-element-grabbing"),l=!0,c.pickedUp&&(o.resetAudios(),o.playAudio(c.pickedUp))}},f=function(o){l&&(o.preventDefault(),"touchmove"===o.type?(t=o.touches[0].clientX-r,n=o.touches[0].clientY-i):(t=o.clientX-r,n=o.clientY-i),p=t,h=n,e.style.transform="translate3d(".concat(t,"px, ").concat(n,"px, 0)"))},v=function(a){if(l){o.isEditor()||(o.currentSceneIndex>0&&o.navigationLeft.show(),o.currentSceneIndex<o.children.length-1&&o.navigationRight.show()),r=t,i=n;var s=d(a.target,e);if(s&&(s.classList.remove("h5p-book-maker-draggable-element-grabbing"),c.dropped&&(o.resetAudios(),o.playAudio(c.dropped))),0!==t&&0!==n){var u=window.getComputedStyle(e),f=parseInt(u.getPropertyValue("left")),v=parseInt(u.getPropertyValue("top"));e.style.left="".concat(f+t,"px"),e.style.top="".concat(v+n,"px"),e.style.transform="",p=0,h=0}l=!1}};s.addEventListener("touchstart",u,!1),s.addEventListener("touchmove",f,!1),s.addEventListener("touchend",v,!1),s.addEventListener("mousedown",u,!1),s.addEventListener("mousemove",f,!1),s.addEventListener("mouseup",v,!1)},q.prototype.disableTabIndexes=function(){var e=this.$container.find(".h5p-popup-container");this.$tabbables=this.$container.find("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]").filter((function(){var t=r(this),n=r.contains(e.get(0),t.get(0));if(t.data("tabindex"))return!0;if(!n){var i=t.attr("tabindex");return t.data("tabindex",i),t.attr("tabindex","-1"),!0}return!1}))},q.prototype.restoreTabIndexes=function(){this.$tabbables&&this.$tabbables.each((function(){var e=r(this),t=e.data("tabindex");e.hasClass("ui-scener-handle")?(e.attr("tabindex",0),e.removeData("tabindex")):void 0!==t?(e.attr("tabindex",t),e.removeData("tabindex")):e.removeAttr("tabindex")}))},q.prototype.createInteractionButton=function(e,t){var n=this,i=e.action.params&&e.action.params.bookMakerAutoplay,o=e.action.metadata?e.action.metadata.title:"";""===o&&(o=e.action.params&&e.action.params.contentName||e.action.library.split(" ")[0].split(".")[1]);var a=this.getLibraryTypePmz(e.action.library),s=r("<div>",{role:"button",tabindex:0,"aria-label":o,"aria-popup":!0,"aria-expanded":!1,class:"h5p-element-button ".concat(a,"-button")}),c=r('<div class="h5p-button-element"></div>');t.attach(c);var l="h5p-advancedtext"===a?{x:e.x,y:e.y}:null;return h(s,(function(){var e;s.attr("aria-expanded","true"),n.showInteractionPopup(t,s,c,a,i,(e=s,function(){return e.attr("aria-expanded","false")}),l),n.disableTabIndexes()})),void 0!==e.action&&"H5P.InteractiveVideo"===e.action.library.substr(0,20)&&t.on("controls",(function(){t.controls.$fullscreen&&t.controls.$fullscreen.remove()})),s},q.prototype.showInteractionPopup=function(e,t,n,r,o,a){var s=this,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=function(){e.trigger("resize")};this.isEditor()||(this.on("exitFullScreen",l),this.showPopup(n,t,c,(function(){s.pauseMedia(e),n.detach(),s.off("exitFullScreen",l),a()}),r),H5P.trigger(e,"resize"),"h5p-image"===r&&this.resizePopupImage(n),setTimeout((function(){var e=n.find(":input").add(n.find("[tabindex]"));e.length?e[0].focus():(n.attr("tabindex",0),n.focus())}),200),i(e.setActivityStarted)&&i(e.getScore)&&e.setActivityStarted(),o&&i(e.play)&&e.play())},q.prototype.getLibraryTypePmz=function(e){return(t=e.split(" ")[0],t.replace(/[\W]/g,"-")).toLowerCase();var t},q.prototype.resizePopupImage=function(e){var t=Number(e.css("fontSize").replace("px","")),n=e.find("img"),r=function(n,r){if(!(r/t<18.5)){var i=n/r;r=18.5*t,e.css({width:r*i,height:r})}};n.height()?r(n.width(),n.height()):n.one("load",(function(){r(this.width,this.height)}))},q.prototype.showPopup=function(e,t){var n,i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"h5p-popup-comment-field",c=this,p=function(e){n?n=!1:(void 0!==a&&setTimeout((function(){a(),c.restoreTabIndexes()}),100),e.preventDefault(),d.addClass("h5p-animate"),d.find(".h5p-popup-container").addClass("h5p-animate"),setTimeout((function(){d.remove()}),100),t.focus())},d=r('<div class="h5p-popup-overlay '+s+'"><div class="h5p-popup-container" role="dialog"><div class="h5p-book-maker-dialog-titlebar"><div class="h5p-dialog-title"></div><div role="button" tabindex="0" class="h5p-close-popup" title="'+this.l10n.close+'"></div></div><div class="h5p-popup-wrapper" role="document"></div></div></div>'),u=d.find(".h5p-popup-wrapper");e instanceof H5P.jQuery?u.append(e):u.html(e);var f=d.find(".h5p-popup-container"),v=function(e,t,n){if(n){t.css({visibility:"hidden"}),e.prependTo(i.$wrapper);var r=t.height(),o=t.width(),a=e.height(),s=o*(100/e.width()),c=r*(100/a);if(s>50&&c>50)e.detach();else{s>c&&c<45&&(s=Math.sqrt(s*c),t.css({width:s+"%"}));var l=100-s-7.5,p=n.x;n.x>l?p=l:n.x<7.5&&(p=7.5);var h=100-(c=t.height()*(100/a))-10,d=n.y;n.y>h?d=h:n.y<10&&(d=10),e.detach(),t.css({left:p+"%",top:d+"%"})}}};return v(d,f,o),d.addClass("h5p-animate"),f.css({visibility:""}).addClass("h5p-animate"),d.prependTo(this.$wrapper).focus().removeClass("h5p-animate").click(p).find(".h5p-popup-container").removeClass("h5p-animate").click((function(){n=!0})).keydown((function(e){e.which===l&&p(e)})).end(),h(d.find(".h5p-close-popup"),(function(e){return p(e)})),d},q.prototype.initKeyEvents=function(){if(void 0===this.keydown){var e=this,t=!1;this.keydown=function(n){t||((37!==n.keyCode&&33!==n.keyCode||!e.previousScene())&&(39!==n.keyCode&&34!==n.keyCode||!e.nextScene())||(n.preventDefault(),t=!0),t&&setTimeout((function(){t=!1}),300))},H5P.jQuery("body").keydown(this.keydown)}},q.prototype.initTouchEvents=function(){var e,t,n,r,i,o,a=this,s=!1,c=!1,l=function(e){return{"-webkit-transform":e,"-moz-transform":e,"-ms-transform":e,transform:e}},p=l("");this.$scenesWrapper.bind("touchstart",(function(l){if(a.slideSliding=!0,!a.blockSliding&&(a.isEditor()||(a.navigationLeft.hide(),a.navigationRight.hide()),!u(l.target))){c=!1,n=e=l.originalEvent.touches[0].pageX,t=l.originalEvent.touches[0].pageY;var p=a.$scenesWrapper.width();r=0===a.currentSceneIndex?0:-p,i=a.currentSceneIndex+1>=a.scenes.length?0:p,o=null,s=!0}})).bind("touchmove",(function(p){if(!u(p.target)){var h=p.originalEvent.touches;s&&(a.$current.prev().addClass("h5p-touch-move"),a.$current.next().addClass("h5p-touch-move"),s=!1),n=h[0].pageX;var d=e-n;null===o&&(o=Math.abs(t-p.originalEvent.touches[0].pageY)>Math.abs(d)),1!==h.length||o||(p.preventDefault(),c||(d<0?a.$current.prev().css(l("translateX("+(r-d)+"px")):a.$current.next().css(l("translateX("+(i-d)+"px)")),a.$current.css(l("translateX("+-d+"px)"))))}})).bind("touchend",(function(){if(!o){var t=e-n;if(t>a.swipeThreshold&&a.nextScene()||t<-a.swipeThreshold&&a.previousScene())return void(a.slideSliding=!1)}a.$scenesWrapper.children().css(p).removeClass("h5p-touch-move"),a.slideSliding=!1,a.blockSliding=!1}))},q.prototype.updateTouchPopup=function(e,t,n,r){if(arguments.length<=0)void 0!==this.touchPopup&&this.touchPopup.remove();else{var i=.15;void 0===this.touchPopup?this.touchPopup=H5P.jQuery("<div/>",{class:"h5p-touch-popup"}).insertAfter(e):this.touchPopup.insertAfter(e),r-e.parent().height()*i<0?r=0:r-=e.parent().height()*i,this.touchPopup.css({"max-width":e.width()-n,left:n,top:r}),this.touchPopup.html()}},q.prototype.previousScene=function(e){var t=this.$current.prev();return!!t.length&&this.jumpToScene(t.index(),e,!1)},q.prototype.nextScene=function(e){var t=this.$current.next();return!!t.length&&this.jumpToScene(t.index(),e,!1)},q.prototype.isCurrentScene=function(e){return this.currentSceneIndex===e},q.prototype.getCurrentSceneIndex=function(){return this.currentSceneIndex},q.prototype.attachAllElements=function(){for(var e=this.$scenesWrapper.children(),t=0;t<this.scenes.length;t++)this.attachElements(e.eq(t),t)},q.prototype.jumpToScene=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this;if(void 0===this.editor&&this.contentId){var i=this.createXAPIEventTemplate("progressed");i.data.statement.object.definition.extensions["http://id.tincanapi.com/extension/ending-point"]=e+1,this.trigger(i)}if(!this.$current.hasClass("h5p-animate")){var o=this.$current.addClass("h5p-animate"),a=r.$scenesWrapper.children(),s=a.filter(":lt("+e+")");this.$current=a.eq(e).addClass("h5p-animate");var c=this.currentSceneIndex;this.currentSceneIndex=e,this.isEditor()||(0===e?(this.navigationLeft.hide(),this.navigationRight.show()):e===a.length-1?(this.navigationLeft.show(),this.navigationRight.hide()):(this.navigationLeft.show(),this.navigationRight.show())),this.pauseAttentionSeekers(c),this.attachElements(this.$current,e),this.runAttentionSeekers(e);var l=this.$current.next();l.length&&this.attachElements(l,e+1),this.setOverflowTabIndex();var p=this.elementInstances[c];if(void 0!==p)for(var h=0;h<p.length;h++)this.pauseMedia(p[h]);return setTimeout((function(){o.removeClass("h5p-current"),a.css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"",transform:""}).removeClass("h5p-touch-move").removeClass("h5p-previous"),s.addClass("h5p-previous"),r.$current.addClass("h5p-current"),r.trigger("changedScene",r.$current.index())}),1),setTimeout((function(){if(r.$scenesWrapper.children().removeClass("h5p-animate"),void 0===r.editor){var e=r.elementInstances[r.currentSceneIndex],t=r.scenes[r.currentSceneIndex].elements;if(void 0!==e)for(var n=0;n<e.length;n++)t[n]&&t[n].action&&t[n].action.params&&t[n].action.params.bookMakerAutoplay&&"function"==typeof e[n].play&&e[n].play(),"function"==typeof e[n].setActivityStarted&&"function"==typeof e[n].getScore&&e[n].setActivityStarted()}}),250),r.navigationLine&&(r.navigationLine.updateProgressBar(e,c),r.navigationLine.updateFooter(e),this.setSceneNumberAnnouncer(e,n)),void 0!==this.editor&&void 0!==this.editor.dnb&&(this.editor.dnb.setContainer(this.$current),this.editor.dnb.blurAll()),this.trigger("resize"),!0}},q.prototype.setOverflowTabIndex=function(){void 0!==this.$current&&this.$current.find(".h5p-element-inner").each((function(){var e,t=r(this);this.classList.contains("h5p-table")&&(e=t.find(".h5p-table").outerHeight());var n=t.closest(".h5p-element-outer").innerHeight();void 0!==e&&null!==n&&e>n&&t.attr("tabindex",0)}))},q.prototype.setSceneNumberAnnouncer=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="";if(!this.navigationLine)return n;n+=this.navigationLine.createSceneTitle(e),this.$sceneAnnouncer.html(n),t&&this.$sceneTop.focus()},q.prototype.resetTask=function(){this.navigationLine.updateProgressBar(0),this.jumpToScene(0,!1),this.$container.find(".h5p-popup-overlay").remove()},q.prototype.getCopyrights=function(){var e,t=new H5P.ContentCopyrights;if(this.book&&this.book.globalBackgroundSelector&&this.book.globalBackgroundSelector.imageGlobalBackground){var n=this.book.globalBackgroundSelector.imageGlobalBackground,r=new H5P.MediaCopyright(n.copyright);r.setThumbnail(new H5P.Thumbnail(H5P.getPath(n.path,this.contentId),n.width,n.height)),t.addMedia(r)}for(var i=0;i<this.scenes.length;i++){var o=new H5P.ContentCopyrights;if(o.setLabel(this.l10n.scene+" "+(i+1)),this.scenes[i]&&this.scenes[i].sceneBackgroundSelector&&this.scenes[i].sceneBackgroundSelector.image){var a=this.scenes[i].sceneBackgroundSelector.image,s=new H5P.MediaCopyright(a.copyright);s.setThumbnail(new H5P.Thumbnail(H5P.getPath(a.path,this.contentId),a.width,a.height)),o.addMedia(s)}if(void 0!==this.elementInstances[i])for(var c=0;c<this.elementInstances[i].length;c++){var l=this.elementInstances[i][c];if(this.scenes[i].elements[c].action){var p=this.scenes[i].elements[c].action.params,h=this.scenes[i].elements[c].action.metadata;e=void 0,void 0!==l.getCopyrights&&(e=l.getCopyrights()),void 0===e&&(e=new H5P.ContentCopyrights,H5P.findCopyrights(e,p,this.contentId,{metadata:h,machineName:l.libraryInfo.machineName}));var d=c+1;void 0!==p.contentName?d+=": "+p.contentName:void 0!==l.getTitle?d+=": "+l.getTitle():p.l10n&&p.l10n.name&&(d+=": "+p.l10n.name),e.setLabel(d),o.addContent(e)}}t.addContent(o)}return t},q.prototype.pauseMedia=function(e){try{void 0!==e.pause&&(e.pause instanceof Function||"function"==typeof e.pause)?e.pause():void 0!==e.video&&void 0!==e.video.pause&&(e.video.pause instanceof Function||"function"==typeof e.video.pause)?e.video.pause():void 0!==e.stop&&(e.stop instanceof Function||"function"==typeof e.stop)&&e.stop()}catch(e){H5P.error(e)}},q.prototype.getXAPIData=function(){var e=this.createXAPIEventTemplate("answered"),t=e.getVerifiedStatementValue(["object","definition"]);H5P.jQuery.extend(t,{interactionType:"compound",type:"http://adlnet.gov/expapi/activities/cmi.interaction"});var n=this.getScore(),r=this.getMaxScore();return e.setScoredResult(n,r,this,!0,n===r),{statement:e.data.statement}},q.prototype.getChildren=function(){return this.children},q.prototype.playAudio=function(e){this.$container.closest(".h5p-content").hasClass("using-mouse")&&e&&e.play()},q.prototype.resetAudios=function(){this.players.forEach((function(e){e.pause(),e.load()}))},q.prototype.kidsloopPreventDragging=function(e){var t=[];"H5P.Image"===(e&&e.libraryInfo&&e.libraryInfo.machineName||null)&&(t=[e.$img.get(0)]),0!==t.length&&this.kidsloopAddPreventDraggingListeners(t)},q.prototype.kidsloopAddPreventDraggingListeners=function(e){var t=this;e.forEach((function(e){e.addEventListener("touchstart",(function(){t.blockSliding=!0})),e.addEventListener("touchend",(function(){t.slideSliding||(t.blockSliding=!1)}))}))},q.ATTENTION_SEEKER_DONE=-1;var W=q;H5P=H5P||{},H5P.BookMaker=W}()}();