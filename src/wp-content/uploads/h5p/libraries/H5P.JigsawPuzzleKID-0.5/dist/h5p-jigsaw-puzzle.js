!function(){"use strict";var t={};function e(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),function(){var e;t.g.importScripts&&(e=t.g.location+"");var i=t.g.document;if(!e&&i&&(i.currentScript&&(e=i.currentScript.src),!e)){var n=i.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e}();var s=function(){function t(){}return t.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],e)&&("object"===n(arguments[0][e])&&"object"===n(arguments[t][e])?this.extend(arguments[0][e],arguments[t][e]):arguments[0][e]=arguments[t][e]);return arguments[0]},t.htmlDecode=function(t){return(new DOMParser).parseFromString(t,"text/html").documentElement.textContent},t.stripHTML=function(t){var e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""},t.formatTime=function(t){var e=[],i=Math.floor(t/3600),n=Math.floor((t-3600*i)/60),s=t-3600*i-60*n;return i>0&&(i<10&&(i="0".concat(i)),e.push("".concat(i))),n<10&&(n="0".concat(n)),e.push("".concat(n)),s<10&&(s="0".concat(s)),e.push("".concat(s)),e.join(":")},t.toISO8601TimePeriod=function(t){if("number"!=typeof t||t<0)return null;var e=[],i=Math.floor(t/3600),n=Math.floor((t-3600*i)/60),s=t-3600*i-60*n;return i>0&&(i<10&&(i="0".concat(i)),e.push("".concat(i,"H"))),(n>0||0===n&&i>0)&&(n<10&&(n="0".concat(n)),e.push("".concat(n,"M"))),s<10&&(s="0".concat(s)),e.push("".concat(s,"S")),"PT".concat(e.join(""))},t.closestParent=function(t,e){if("object"!==n(t)||"string"!=typeof e)return null;if(!t.parentNode)return null;if("."===e.substr(0,1)){if(e.split(".").filter((function(t){return""!==t})).every((function(e){var i,n;return null===(i=t.parentNode)||void 0===i||null===(n=i.classList)||void 0===n?void 0:n.contains(e)})))return t.parentNode}else if("#"===e.substr(0,1)){if("function"==typeof t.parentNode.getAttribute&&t.parentNode.getAttribute("id")===e.substr(1))return t.parentNode}else if(t.parentNode.tagName.toLowerCase()===e.toLowerCase())return t.parentNode;return this.closestParent(t.parentNode,e)},t.shuffleArray=function(t){var i,n,s,a=e(t);for(s=a.length-1;s>0;s--)i=Math.floor(Math.random()*(s+1)),n=a[s],a[s]=a[i],a[i]=n;return a},t.getRelativePosition=function(t,e){if(null==t||!t.x||null==t||!t.y||"function"!=typeof(null==e?void 0:e.getBoundingClientRect))return null;var i=e.getBoundingClientRect();return{x:t.x/i.width,y:t.y/i.height}},t.getAbsolutePosition=function(t,e){if(null==t||!t.x||null==t||!t.y||"function"!=typeof(null==e?void 0:e.getBoundingClientRect))return null;var i=e.getBoundingClientRect();return{x:t.x*i.width,y:t.y*i.height}},t}(),a=s,o=function(){function t(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.params=e,this.callbacks=a.extend({onPuzzleTileCreated:function(){},onPuzzleTileMoveStarted:function(){},onPuzzleTileMoved:function(){},onPuzzleTileMoveEnded:function(){},onHintClosed:function(){}},i),this.pathBorders={},this.moveInitialX=null,this.moveInitialY=null,this.deltaX=null,this.deltaY=null,this.isDone=!1,this.scale=1,this.backgroundImage=new Image,this.backgroundImage.addEventListener("load",(function(){t.handleImageLoaded()})),this.backgroundImage.crossOrigin=e.imageCrossOrigin,this.backgroundImage.src=e.imageSource,this.handleTileMoveStarted=this.handleTileMoveStarted.bind(this),this.handleTileMoved=this.handleTileMoved.bind(this),this.handleTileMoveEnded=this.handleTileMoveEnded.bind(this),this.handleAnimationMoveEnded=this.handleAnimationMoveEnded.bind(this),this.tile=document.createElement("div"),this.tile.classList.add("h5p-jigsaw-puzzle-tile"),this.setScale(this.scale)}var e=t.prototype;return e.getDOM=function(){return this.tile},e.getHTML=function(){return this.tile.outerHTML},e.buildSVG=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=document.createElement("svg");i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("viewBox","0 0 ".concat(e.width+e.stroke," ").concat(e.height+e.stroke));var n=document.createElement("defs"),s=document.createElement("pattern");s.setAttribute("id","h5p-jigsaw-puzzle-".concat(this.params.uuid,"-pattern-").concat(this.params.id)),s.setAttribute("width",this.params.size.width),s.setAttribute("height",this.params.size.height),s.setAttribute("x",-(this.params.gridPosition.x*this.params.baseWidth*this.scale-Math.sign(this.params.gridPosition.x)*this.knob/2)/this.width),s.setAttribute("y",-(this.params.gridPosition.y*this.params.baseHeight*this.scale-Math.sign(this.params.gridPosition.y)*this.knob/2)/this.height);var a=document.createElement("image");a.setAttribute("width",e.image.naturalWidth),a.setAttribute("height",e.image.naturalHeight),a.setAttribute("href",e.image.src),s.appendChild(a),n.appendChild(s),i.appendChild(n);var o=document.createElement("path");return o.setAttribute("fill","url(#h5p-jigsaw-puzzle-".concat(this.params.uuid,"-pattern-").concat(this.params.id,")")),o.setAttribute("stroke-opacity","0"),o.setAttribute("stroke-width",e.stroke),o.setAttribute("d",this.buildPathDash({width:e.baseWidth,height:e.baseHeight,type:e.type,stroke:e.stroke})),i.appendChild(o),["top","right","bottom","left"].forEach((function(n){t.pathBorders[n]=t.buildPathDOM({stroke:e.stroke,color:t.params.borderColor,width:e.baseWidth,height:e.baseHeight,orientation:t.params.borders[n].orientation,opacity:t.params.borders[n].opacity,side:n,gridPosition:{x:t.params.gridPosition.x,y:t.params.gridPosition.y},className:"border-".concat(n)}),i.appendChild(t.pathBorders[n])})),i},e.buildPathDOM=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=document.createElement("path");return t.className&&e.classList.add(t.className),e.setAttribute("fill-opacity","0"),e.setAttribute("stroke",t.color),e.setAttribute("stroke-width",t.stroke),e.setAttribute("stroke-opacity",t.opacity),e.setAttribute("d",this.buildPathSegment({width:t.width,height:t.height,orientation:t.orientation,stroke:t.stroke,side:t.side,gridPosition:{x:this.params.gridPosition.x,y:this.params.gridPosition.y}})),e},e.buildPathSegment=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Math.min(e.width,e.height)/2,n="right"===e.side?e.width:0;0!==e.gridPosition.x&&(n+=e.stroke/2+i/2);var s="bottom"===e.side?e.height:0;0!==e.gridPosition.y&&(s+=e.stroke/2+i/2);var a="M ".concat(n,", ").concat(s),o="top"===e.side||"bottom"===e.side?"horizontal":"vertical",r=t.PATHS_BORDER["".concat(o,"-").concat(e.orientation)];return"".concat(a," ").concat(r).replace(/@w/g,e.width).replace(/@h/g,e.height).replace(/@knob/g,i).replace(/@gapw/g,(e.width-i)/2).replace(/@gaph/g,(e.height-i)/2)},e.buildPathDash=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Math.min(e.width,e.height)/2;return t.PATHS[e.type].replace(/@offknob/g,e.stroke/2+i/2).replace(/@off/g,e.stroke/2).replace(/@w/g,e.width).replace(/@h/g,e.height).replace(/@knob/g,i).replace(/@gapw/g,(e.width-i)/2).replace(/@gaph/g,(e.height-i)/2)},e.setZIndex=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";""!==t&&"number"!=typeof t||(this.tile.style.zIndex=t)},e.getGridPosition=function(){return{x:this.params.gridPosition.x,y:this.params.gridPosition.y}},e.getId=function(){return this.params.id},e.setScale=function(t){"number"!=typeof t||t<0||(this.scale=t,this.width=this.scale*this.params.width,this.height=this.scale*this.params.height,this.knob=this.scale*this.params.knobSize,this.stroke=this.scale*this.params.stroke,this.tile.style.width="".concat(this.width+this.stroke,"px"),this.tile.style.height="".concat(this.height+this.stroke,"px"))},e.getSize=function(){return this.tile.style.width&&this.tile.style.height?{baseWidth:this.params.baseWidth,baseHeight:this.params.baseHeight,width:this.width,height:this.height,knob:this.knob,stroke:this.stroke}:null},e.getPosition=function(){return this.tile.style.left&&this.tile.style.top?{x:parseFloat(this.tile.style.left),y:parseFloat(this.tile.style.top)}:null},e.setPosition=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("number"==typeof t.x&&"number"==typeof t.y){var e=this.params.container,i=e.offsetLeft,n=e.offsetLeft+e.offsetWidth-this.width,s=e.offsetTop,a=e.offsetTop+e.offsetHeight-this.height;this.tile.style.left="".concat(Math.min(Math.max(i,t.x),n),"px"),this.tile.style.top="".concat(Math.min(Math.max(s,t.y),a),"px")}},e.setDone=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isDone=t},e.show=function(){this.tile.classList.remove("hidden")},e.hide=function(){this.tile.classList.add("hidden")},e.showHint=function(){this.isShowingHint=!0,this.tile.classList.add("hint")},e.hideHint=function(){this.tile.classList.remove("hint"),this.isShowingHint=!1},e.ghost=function(){this.tile.classList.add("ghosted")},e.unghost=function(){this.tile.classList.remove("ghosted")},e.enable=function(){this.tile.removeAttribute("disabled","disabled"),this.isDisabled=!1},e.disable=function(){this.isDisabled=!0,this.tile.setAttribute("disabled","disabled")},e.putInBackground=function(){this.tile.classList.remove("onTop")},e.putOnTop=function(){this.tile.classList.add("onTop")},e.animateMove=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.duration=e.duration||t.HINT_DURATION,this.tile.removeEventListener("transitionend",this.handleAnimationMoveEnded),this.tile.addEventListener("transitionend",this.handleAnimationMoveEnded),e.duration!==t.HINT_DURATION&&(this.tile.style.transitionDuration="".concat(e.duration,"s")),this.tile.classList.add("animate-move")},e.setBorders=function(t){for(var e in t){if("boolean"!=typeof t[e])return;var i=this.tile.querySelector(".border-".concat(e));i&&i.setAttribute("stroke-opacity",t[e]?"1":"0")}},e.repaintSVG=function(){var t=this.buildSVG({id:this.params.id,gridPosition:this.params.gridPosition,baseWidth:this.params.baseWidth,baseHeight:this.params.baseHeight,width:this.params.width,height:this.params.height,stroke:this.params.stroke,image:this.backgroundImage,type:this.params.type});this.tile.innerHTML=t.outerHTML},e.handleImageLoaded=function(){this.setScale(this.scale),this.repaintSVG(),this.callbacks.onPuzzleTileCreated(this),this.tile.addEventListener("touchstart",this.handleTileMoveStarted,!0),this.tile.addEventListener("mousedown",this.handleTileMoveStarted,!0)},e.handleTileMoveStarted=function(t){this.isDisabled?this.isShowingHint&&this.callbacks.onHintClosed():((t=t||window.event).preventDefault(),this.handleAnimationMoveEnded(),"touchstart"===t.type?(this.moveInitialX=this.tile.offsetLeft-t.touches[0].clientX,this.moveInitialY=this.tile.offsetTop-t.touches[0].clientY,this.tile.addEventListener("touchmove",this.handleTileMoved,!1),this.tile.addEventListener("touchend",this.handleTileMoveEnded,!1)):(this.moveInitialX=this.tile.offsetLeft-t.clientX,this.moveInitialY=this.tile.offsetTop-t.clientY,document.addEventListener("mousemove",this.handleTileMoved,!0),document.addEventListener("mouseup",this.handleTileMoveEnded,!0)),this.callbacks.onPuzzleTileMoveStarted(this))},e.handleTileMoved=function(t){(t=t||window.event).preventDefault(),"touchmove"===t.type?this.setPosition({x:this.moveInitialX+t.touches[0].clientX,y:this.moveInitialY+t.touches[0].clientY}):this.setPosition({x:this.moveInitialX+t.clientX,y:this.moveInitialY+t.clientY}),this.callbacks.onPuzzleTileMoved(this)},e.handleTileMoveEnded=function(){this.tile.removeEventListener("touchmove",this.handleTileMoved,!1),this.tile.removeEventListener("touchend",this.handleTileMoveEnded,!1),document.removeEventListener("mousemove",this.handleTileMoved,!0),document.removeEventListener("mouseup",this.handleTileMoveEnded,!0),this.callbacks.onPuzzleTileMoveEnded(this)},e.handleAnimationMoveEnded=function(){this.tile.style.transitionDuration="",this.tile.classList.remove("animate-move"),this.tile.removeEventListener("transitionend",this.handleAnimationMoveEnded)},t}();o.PATHS={"top-left":"M @off, @off l @w, 0 l 0, @gaph a 1 1 0 0 0 0 @knob l 0, @gaph l -@gapw, 0 a 1 1 0 0 0 -@knob 0 l -@gapw, 0 l 0 -@h Z","top-inner":"M @offknob, @off l @w, 0 l 0, @gaph a 1 1 0 0 0 0 @knob l 0, @gaph l -@gapw, 0 a 1 1 0 0 0 -@knob 0 l -@gapw, 0 l 0, -@gaph a 1 1 0 0 1 0 -@knob l 0, -@gaph Z","top-right":"M @offknob, @off l @w, 0 l 0, @h l -@gapw, 0 a 1 1 0 0 0 -@knob 0 l -@gapw, 0 l 0, -@gaph a 1 1 0 0 1 0 -@knob l 0, -@gaph Z","inner-left":"M @off, @offknob l @gapw, 0 a 1 1 0 0 1 @knob 0 l @gapw, 0 l 0, @gaph a 1 1 0 0 0 0 @knob l 0, @gaph l -@gapw, 0 a 1 1 0 0 0 -@knob 0 l -@gapw, 0 l 0, -@h Z","inner-inner":"M @offknob, @offknob l @gapw, 0 a 1 1 0 0 1 @knob 0 l @gapw, 0 l 0, @gaph a 1 1 0 0 0 0 @knob l 0, @gaph l -@gapw, 0 a 1 1 0 0 0 -@knob 0 l -@gapw, 0 l 0, -@gaph a 1 1 0 0 1 0 -@knob l 0, -@gaph Z","inner-right":"M @offknob, @offknob l @gapw, 0 a 1 1 0 0 1 @knob 0 l @gapw, 0 l 0, @h l -@gapw, 0 a 1 1 0 0 0 -@knob 0 l -@gapw, 0 l 0, -@gaph a 1 1 0 0 1 0 -@knob l 0, -@gaph Z","bottom-left":"M @off, @offknob l @gapw, 0 a 1 1 0 0 1 @knob 0 l @gapw, 0 l 0, @gaph a 1 1 0 0 0 0 @knob l 0, @gaph l -@w, 0 l 0, -@h Z","bottom-inner":"M @offknob, @offknob l @gapw, 0 a 1 1 0 0 1 @knob 0 l @gapw, 0 l 0, @gaph a 1 1 0 0 0 0 @knob l 0, @gaph l -@w, 0 l 0, -@gaph a 1 1 0 0 1 0 -@knob l 0, -@gaph Z","bottom-right":"M @offknob, @offknob l @gapw, 0 a 1 1 0 0 1 @knob 0 l @gapw, 0 l 0, @h l -@w, 0 l 0, -@gaph a 1 1 0 0 1 0 -@knob l 0, -@gaph Z"},o.PATHS_BORDER={"horizontal-straight":"l @w, 0","horizontal-up":"l @gapw, 0 a 1 1 0 0 1 @knob 0 l @gapw, 0","horizontal-down":"l @gapw, 0 a 1 1 0 0 0 @knob 0 l @gapw, 0","vertical-straight":"l 0, @h","vertical-left":"l 0, @gaph a 1 1 0 0 0 0 @knob l 0, @gaph","vertical-right":"l 0, @gaph a 1 1 0 0 1 0 @knob l 0, @gaph"},o.HINT_DURATION=.5;var r=function(){function t(t,e){var i=this;this.params=a.extend({a11y:{active:"",disabled:"",inactive:""},active:!1,classes:[],disabled:!1,hidden:!1,type:"pulse",noTabWhenDisabled:!1},t||{}),Array.isArray(this.params.classes)||(this.params.classes=[this.params.classes]),"pulse"===this.params.type&&(this.params.a11y.inactive||(this.params.a11y.inactive=this.params.a11y.active||""),this.params.a11y.active||(this.params.a11y.active=this.params.a11y.inactive||"")),this.active=this.params.active,this.disabled=this.params.disabled,this.callbacks=a.extend({onClick:function(){}},e),this.button=document.createElement("button"),this.params.classes&&this.params.classes.forEach((function(t){i.button.classList.add(t)})),this.button.setAttribute("aria-pressed",this.params.active),this.button.setAttribute("tabindex","0"),!0===this.params.active?this.activate():this.deactivate(),!0===this.params.disabled?this.disable():this.enable(),!0===this.params.hidden?this.hide():this.show(),this.button.addEventListener("click",(function(t){i.disabled||("toggle"===i.params.type&&i.toggle(),i.callbacks.onClick(t))}))}var e=t.prototype;return e.getDOM=function(){return this.button},e.show=function(){this.button.classList.remove("h5p-jigsaw-puzzle-display-none")},e.hide=function(){this.button.classList.add("h5p-jigsaw-puzzle-display-none")},e.enable=function(){this.disabled=!1,this.button.classList.remove("h5p-jigsaw-puzzle-button-disabled"),this.params.noTabWhenDisabled&&this.button.setAttribute("tabindex",0),this.active?this.activate():this.deactivate()},e.disable=function(){this.button.classList.add("h5p-jigsaw-puzzle-button-disabled"),this.button.setAttribute("aria-label",this.params.a11y.disabled),this.params.noTabWhenDisabled&&this.button.setAttribute("tabindex",-1),this.disabled=!0},e.activate=function(){this.disabled||("toggle"===this.params.type&&(this.button.classList.add("h5p-jigsaw-puzzle-button-active"),this.button.setAttribute("aria-pressed",!0)),this.button.setAttribute("aria-label",this.params.a11y.active),this.active=!0)},e.deactivate=function(){this.disabled||(this.active=!1,"toggle"===this.params.type&&(this.button.classList.remove("h5p-jigsaw-puzzle-button-active"),this.button.setAttribute("aria-pressed",!1)),this.button.setAttribute("aria-label",this.params.a11y.inactive))},e.toggle=function(t){this.disabled||((t="boolean"==typeof t?t:!this.active)?this.activate():this.deactivate())},e.isActive=function(){return this.active},e.isDisabled=function(){return this.disabled},t}(),l=function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.params=a.extend({l10n:{timeLeft:"Time left:",hintsUsed:"Hints used:"},timeLeft:!1,hintsUsed:0},t),this.statusInfo=document.createElement("div"),this.statusInfo.classList.add("h5p-jigsaw-puzzle-status-info"),this.addTimeLeftBlock(),this.addHintsUsedBlock()}var e=t.prototype;return e.getDOM=function(){return this.statusInfo},e.addTimeLeftBlock=function(){this.statusTime=document.createElement("div"),this.statusTime.classList.add("h5p-jigsaw-puzzle-status"),this.statusTime.classList.add("hidden");var t=document.createElement("div");t.classList.add("h5p-jigsaw-puzzle-status-icon"),t.classList.add("h5p-jigsaw-puzzle-status-icon-time"),this.statusTime.appendChild(t),this.statusTextTime=document.createElement("div"),this.statusTime.appendChild(this.statusTextTime),this.statusInfo.appendChild(this.statusTime)},e.addHintsUsedBlock=function(){this.statusHint=document.createElement("div"),this.statusHint.classList.add("h5p-jigsaw-puzzle-status"),this.statusHint.classList.add("hidden");var t=document.createElement("div");t.classList.add("h5p-jigsaw-puzzle-status-icon"),t.classList.add("h5p-jigsaw-puzzle-status-icon-hint"),this.statusHint.appendChild(t),this.statusTextHint=document.createElement("div"),this.statusHint.appendChild(this.statusTextHint),this.statusInfo.appendChild(this.statusHint)},e.setTimeLeft=function(t){this.statusTime.classList.remove("hidden"),this.statusTextTime.innerHTML="number"==typeof t?a.formatTime(t):t},e.setHintsUsed=function(t){this.statusHint.classList.remove("hidden"),this.statusTextHint.innerHTML=t},t}(),h=function(){function t(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.params=a.extend({a11y:{buttonFullscreenEnter:"Enter fullscreen mode",buttonFullscreenExit:"Exit fullscreen mode",buttonAudioMute:"Mute background music",buttonAudioUnmute:"Unmute background music"}},e),this.callbacks=a.extend({onButtonFullscreenClicked:function(){},onButtonAudioClicked:function(){}},i),this.titleBar=document.createElement("div"),this.titleBar.classList.add("h5p-jigsaw-puzzle-title-bar"),this.statusInfo=new l,this.titleBar.appendChild(this.statusInfo.getDOM()),this.buttonAudio=new r({type:"toggle",classes:["h5p-jigsaw-puzzle-button","h5p-jigsaw-puzzle-button-audio"],disabled:!0,noTabWhenDisabled:!0,hidden:!0,a11y:{active:this.params.a11y.buttonAudioMute,inactive:this.params.a11y.buttonAudioUnmute,disabled:this.params.a11y.disabled}},{onClick:function(e){t.callbacks.onButtonAudioClicked(e)}}),this.titleBar.appendChild(this.buttonAudio.getDOM()),this.buttonFullscreen=new r({type:"toggle",classes:["h5p-jigsaw-puzzle-button","h5p-jigsaw-puzzle-button-fullscreen"],disabled:!0,noTabWhenDisabled:!0,hidden:!0,a11y:{active:this.params.a11y.buttonFullscreenExit,inactive:this.params.a11y.buttonFullscreenEnter,disabled:this.params.a11y.disabled}},{onClick:function(){t.callbacks.onButtonFullscreenClicked()}}),this.titleBar.appendChild(this.buttonFullscreen.getDOM())}var e=t.prototype;return e.getDOM=function(){return this.titleBar},e.setHintsUsed=function(t){this.statusInfo.setHintsUsed(t)},e.setTimeLeft=function(t){this.statusInfo.setTimeLeft(t)},e.showFullscreenButton=function(){this.buttonFullscreen.show()},e.showAudioButton=function(){this.buttonAudio.show()},e.disableFullscreenButton=function(){this.buttonFullscreen.disable()},e.disableAudioButton=function(){this.buttonAudio.disable()},e.enableFullscreenButton=function(){this.buttonFullscreen.enable()},e.enableAudioButton=function(){this.buttonAudio.enable()},e.getAudioButtonState=function(){return this.buttonAudio.isActive()},e.toggleFullscreenButton=function(t){"string"==typeof t&&("enter"===t?t=!1:"exit"===t&&(t=!0)),"boolean"==typeof t&&this.buttonFullscreen.toggle(t)},e.toggleAudioButton=function(t){"string"==typeof t&&("mute"===t?t=!1:"unmute"===t&&(t=!0)),"boolean"==typeof t&&this.buttonAudio.toggle(t)},t}(),u=t.p+"assets/puzzle-default-song-1.mp3",d=t.p+"assets/puzzle-default-song-2.mp3",c=t.p+"assets/puzzle-default-song-3.mp3",p=t.p+"assets/puzzle-default-song-4.mp3",m=t.p+"assets/shaky-puzzle.mp3",g=t.p+"assets/puzzle-tile-pickup.mp3",f=t.p+"assets/puzzle-tile-correct.mp3",b=t.p+"assets/puzzle-tile-incorrect.mp3",v=t.p+"assets/puzzle-fully-complete.mp3",z=t.p+"assets/puzzle-hint.mp3",y=function(){function t(){var t,e,i,n,s,o=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.params=r,this.callbacks=a.extend({onResize:function(){},onCompleted:function(){},onButtonFullscreenClicked:function(){},onHintDone:function(){},onInteracted:function(){},onPuzzleReset:function(){},onChanged:function(){}},l),this.audios=[],this.audiosToKeepAlive=["backgroundMusic"],this.tiles=[],this.originalSize=null,this.maxSize={heigth:null,width:null},this.borderWidth=2,this.hintsUsed=(null===(t=this.params.previousState)||void 0===t?void 0:t.hintsUsed)||0,this.timeLeft=null!==(e=null===(i=this.params.previousState)||void 0===i?void 0:i.timeLeft)&&void 0!==e?e:this.params.timeLimit,this.isAnswerGiven=!1,this.h5pQuestionContent=null,this.h5pQuestionButtons=null,this.content=document.createElement("div"),this.content.classList.add("h5p-jigsaw-puzzle-content"),null===(n=this.params)||void 0===n||null===(s=n.puzzleImageInstance)||void 0===s||!s.source){var h=document.createElement("div");return h.classList.add("h5p-jigsaw-puzzle-message"),h.innerText=this.params.l10n.messageNoImage,void this.content.appendChild(h)}this.addTitlebar(),this.addPuzzleArea(),this.overlay=document.createElement("button"),this.overlay.classList.add("h5p-jigsaw-puzzle-overlay"),this.overlay.classList.add("disabled"),this.content.appendChild(this.overlay),this.image=document.createElement("img"),this.image.addEventListener("load",(function(){o.handleImageLoaded(o.params.imageFormat)})),this.imageCrossOrigin="function"==typeof H5P.getCrossOrigin?H5P.getCrossOrigin(r.puzzleImageInstance.source):"Anonymous",this.image.src=r.puzzleImageInstance.source,this.attentionSeeker=new H5P.AttentionSeeker,"undefined"==typeof H5PEditor&&this.addAudios()}var e=t.prototype;return e.getDOM=function(){return this.content},e.addTitlebar=function(){var t=this;this.titlebar=new h({a11y:{buttonFullscreenEnter:this.params.a11y.buttonFullscreenEnter,buttonFullscreenExit:this.params.a11y.buttonFullscreenExit,buttonAudioMute:this.params.a11y.buttonAudioMute,buttonAudioUnmute:this.params.a11y.buttonAudioUnmute,disabled:this.params.a11y.disabled}},{onButtonAudioClicked:function(e){t.handleButtonAudioClicked(e)},onButtonFullscreenClicked:function(e){t.handleButtonFullscreenClicked(e)}}),this.params.showHintCounter&&this.titlebar.setHintsUsed(this.hintsUsed),this.timeLeft&&this.titlebar.setTimeLeft(this.timeLeft),this.content.appendChild(this.titlebar.getDOM())},e.addPuzzleArea=function(){var t=this;this.puzzleArea=document.createElement("div"),this.puzzleArea.classList.add("h5p-jigsaw-puzzle-puzzle-area"),this.content.appendChild(this.puzzleArea),this.puzzleDropzone=document.createElement("div"),this.puzzleDropzone.classList.add("h5p-jigsaw-puzzle-tile-container"),this.puzzleArea.appendChild(this.puzzleDropzone),window.requestAnimationFrame((function(){var e=window.getComputedStyle(t.puzzleDropzone);t.borderWidth=parseFloat(e.getPropertyValue("border-width"))||t.borderWidth}));var e=document.createElement("div");e.classList.add("h5p-jigsaw-puzzle-sorting-area"),e.style.width="".concat(100*this.params.sortingSpace/(100-this.params.sortingSpace),"%"),this.puzzleArea.appendChild(e)},e.createPuzzleTile=function(t){var e=this,i=this.image.naturalWidth/this.params.size.width,n=this.image.naturalHeight/this.params.size.height,s=Math.min(i,n)/2,a=i+(t.x>0?s/2:0),r=n+(t.y>0?s/2:0),l={top:{orientation:0===t.y?"straight":"up",opacity:1},right:{orientation:t.x+1===this.params.size.width?"straight":"left",opacity:1},bottom:{orientation:t.y+1===this.params.size.height?"straight":"up",opacity:1},left:{orientation:0===t.x?"straight":"left",opacity:1}},h="inner";0===t.y?h="top":t.y+1===this.params.size.height&&(h="bottom");var u="inner";0===t.x?u="left":t.x+1===this.params.size.width&&(u="right");var d="".concat(h,"-").concat(u);return new o({id:t.y*this.params.size.width+t.x,baseWidth:i,baseHeight:n,width:a,height:r,gridPosition:{x:t.x,y:t.y},knobSize:s,imageSource:this.image.src,imageCrossOrigin:this.imageCrossOrigin,type:d,stroke:this.params.stroke,borderColor:this.params.tileBorderColor,borders:l,uuid:this.params.uuid,container:this.puzzleArea,size:this.params.size},{onPuzzleTileCreated:function(t){e.handlePuzzleTileCreated(t)},onPuzzleTileMoveStarted:function(t){e.handlePuzzleTileMoveStarted(t)},onPuzzleTileMoved:function(t){e.handlePuzzleTileMoved(t)},onPuzzleTileMoveEnded:function(t){e.handlePuzzleTileMoveEnded(t)},onHintClosed:function(){e.overlay.click()}})},e.setTilePosition=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.tile&&("number"!=typeof e.x||e.x<0||"number"!=typeof e.y||e.y<0||(e.animate=null!==(t=e.animate)&&void 0!==t&&t,e.animate&&e.tile.animateMove({duration:e.duration}),this.tiles[e.tile.getId()].position={x:(e.x-this.puzzleDropzone.offsetLeft)/this.puzzleArea.offsetWidth,y:(e.y-this.puzzleDropzone.offsetTop)/this.puzzleArea.offsetHeight},e.tile.setPosition({x:e.x,y:e.y})))},e.getAssetPath=function(t){var e,i;if(-1!==t.indexOf("sites/default/files/h5p/development"))return t;var n=null,s=null===(e=H5PIntegration)||void 0===e||null===(i=e.contents["cid-".concat(this.params.contentId)])||void 0===i?void 0:i.library;if(-1!==(null==s?void 0:s.indexOf("H5P.JigsawPuzzleKID "))&&(n=s.replace(" ","-")),!n){var a,o,r=null===(a=H5PIntegration)||void 0===a||null===(o=a.contents["cid-".concat(this.params.contentId)])||void 0===o?void 0:o.jsonContent;if(!r)return null;var l=RegExp('"library":"(H5P.JigsawPuzzleKID [0-9]+.[0-9]+)"'),h=r.match(l);h&&(n=h[1].replace(" ","-"))}if(!n)return null;var u=H5P.getLibraryPath(n),d=t.substr(t.indexOf("/assets"));return"".concat(u,"/dist").concat(d)},e.getTimeLeft=function(){var t;return null!==(t=this.timeLeft)&&void 0!==t?t:null},e.addAudios=function(){var e=this;if(this.params.sound&&!this.audiosDefined&&H5P.SoundJS.initializeDefaultPlugins()){H5P.SoundJS.alternateExtensions=["mp3"];var i=null;if("custom"===this.params.sound.backgroundMusic)this.params.sound.backgroundMusicCustom&&this.params.sound.backgroundMusicCustom.length>0&&this.params.sound.backgroundMusicCustom[0].path&&(i=H5P.getPath(this.params.sound.backgroundMusicCustom[0].path,this.params.contentId));else if(this.params.sound.backgroundMusic){var n=this.getAssetPath(t.AUDIOS[this.params.sound.backgroundMusic]);n&&(i=n)}i&&(this.titlebar.showAudioButton(),this.addAudio("backgroundMusic",i,{interrupt:H5P.SoundJS.INTERRUPT_NONE,loop:-1})),["puzzleStarted","puzzleTilePickUp","puzzleTileCorrect","puzzleTileIncorrect","puzzleCompleted","puzzleHint"].forEach((function(i){var n;(n=e.params.sound[i]&&e.params.sound[i].length>0&&e.params.sound[i][0].path?H5P.getPath(e.params.sound[i][0].path,e.params.contentId):e.getAssetPath(t.AUDIOS[i]))&&e.addAudio(i,n,{interrupt:H5P.SoundJS.INTERRUPT_NONE})}))}},e.addAudio=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.removeAudio(t),this.audios[t]={params:i},H5P.SoundJS.registerSound(e,t)},e.removeAudio=function(t){H5P.SoundJS.removeSound(t),delete this.audios[t]},e.startAudio=function(t){this.audios[t]&&H5P.SoundJS.play(t,this.audios[t].params||{})},e.stopAudios=function(){H5P.SoundJS.stop()},e.setH5PQuestionElements=function(t){this.h5pQuestionContent=t.querySelector(".h5p-question-content"),this.h5pQuestionButtons=t.querySelector(".h5p-question-buttons")},e.enableFullscreenButton=function(){this.titlebar&&(this.titlebar.enableFullscreenButton(),this.titlebar.showFullscreenButton())},e.toggleFullscreen=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.titlebar.toggleFullscreenButton(t),this.setFixedHeight(t)},e.setFixedHeight=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t){var e=window.getComputedStyle(this.h5pQuestionContent),i=parseFloat(e.getPropertyValue("margin-bottom")),n=parseFloat(e.getPropertyValue("margin-left"))+parseFloat(e.getPropertyValue("margin-right")),s=window.getComputedStyle(this.h5pQuestionButtons),a=parseFloat(s.getPropertyValue("margin-bottom"))+parseFloat(s.getPropertyValue("margin-top"));this.maxSize={height:window.innerHeight-2*this.params.stroke-this.puzzleArea.offsetTop-i-a-this.h5pQuestionButtons.offsetHeight,width:(window.innerWidth-2*this.params.stroke-n)*(100-this.params.sortingSpace)/100}}else this.maxSize={heigth:null,width:null};this.handleResized()},e.runTimer=function(){var t=this;this.titlebar.setTimeLeft(this.timeLeft),0!==this.timeLeft?(clearTimeout(this.timer),this.timer=setTimeout((function(){t.timeLeft--,t.runTimer()}),1e3)):this.handleTimeUp()},e.stopHintTimer=function(){clearTimeout(this.hintTimer)},e.stopAttentionTimer=function(){clearTimeout(this.attentionTimer),this.attentionSeeker.unregisterAll()},e.runHintTimer=function(){var t,e,i=this;null===(t=this.params)||void 0===t||!t.autoHintInterval||this.timeLeft&&(null===(e=this.params)||void 0===e?void 0:e.autoHintInterval)>this.timeLeft||(this.stopHintTimer(),this.hintTimer=setTimeout((function(){i.showHint(i.attentionTile)}),1e3*this.params.autoHintInterval))},e.runAttentionTimer=function(){var t,e,i,n=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null===(t=this.params.attentionSeeker)||void 0===t||!t.style||null===(e=this.params.attentionSeeker)||void 0===e||!e.interval||this.timeLeft&&(null===(i=this.params.attentionSeeker)||void 0===i?void 0:i.interval)>this.timeLeft||(s.keepAlive||(this.stopAttentionTimer(),this.attentionTile=null),this.attentionTimer=setTimeout((function(){n.stopAttentionTimer();var t=n.tiles.filter((function(t){return!t.instance.isDone}));if(0!==t.length){t.forEach((function(t){t.instance.putInBackground()})),n.attentionTile=n.attentionTile||t[Math.floor(Math.random()*t.length)].instance;var e=n.attentionSeeker.register({element:n.attentionTile.getDOM(),style:n.params.attentionSeeker.style,interval:0,repeat:1});n.attentionTile.putOnTop(),n.attentionSeeker.run(e),n.runAttentionTimer({keepAlive:!0})}}),1e3*this.params.attentionSeeker.interval))},e.stopOverlayShowing=function(){this.isOverlayShowing&&(this.titlebar.enableAudioButton(),this.titlebar.enableFullscreenButton(),clearTimeout(this.animateHintTimeout),this.hideOverlay(),this.callbacks.onHintDone())},e.reset=function(){var t=this;this.stopOverlayShowing(),setTimeout((function(){t.tiles.forEach((function(e){t.showTileBorders(e.instance),e.instance.enable(),e.instance.setDone(!1)})),t.randomizeTiles({useFullArea:t.params.useFullArea,layout:t.params.randomizerPattern,keepDone:!1}),t.hintsUsed=0,t.params.showHintCounter&&t.titlebar.setHintsUsed(t.hintsUsed),t.isAnswerGiven=!1,t.params.timeLimit&&(t.timeLeft=t.params.timeLimit,t.runTimer()),t.runAttentionTimer(),t.runHintTimer(),t.startAudio("puzzleStarted",{silence:!0,keepAlives:t.audiosToKeepAlive})}),0)},e.randomizeTiles=function(){for(var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.shuffleArray(this.tiles),s=n.length;s>=0;s--)this.puzzleArea.appendChild(n[Math.random()*s|0].instance.getDOM());i.keepDone&&(n=n.map((function(t){return t.instance.isDone?null:t})));var o=this.tiles.reduce((function(t,e){return{width:Math.max(t.width,e.instance.getSize().width),height:Math.max(t.height,e.instance.getSize().height)}}),{width:0,height:0}),r=i.useFullArea||this.puzzleArea.offsetWidth*this.params.sortingSpace/100<o.width,l=r?this.puzzleArea.offsetLeft+0:this.puzzleArea.offsetLeft+this.puzzleArea.offsetWidth*(1-this.params.sortingSpace/100),h={width:r?this.puzzleArea.offsetWidth-o.width:this.puzzleArea.offsetWidth*this.params.sortingSpace/100-o.width,height:this.puzzleArea.offsetHeight-o.height};n.forEach((function(n,s){if(null!==n){var a=n.instance,r=Math.floor(s/e.params.size.width),u=s%e.params.size.width,d=0,c=0;if(i.layout===t.LAYOUT_STAGGERED){if(r%2==1){var p=h.width-h.width/e.params.size.width;d=p/(e.params.size.width-1)/2+l+p/(e.params.size.width-1)*u+(o.width-a.getSize().width)}else d=l+h.width/(e.params.size.width-1)*u+(o.width-a.getSize().width);c=e.puzzleArea.offsetTop+h.height/(e.params.size.height-1)*r+(o.height-a.getSize().height)}else d=l+Math.random()*h.width,c=e.puzzleArea.offsetTop+Math.random()*h.height;e.setTilePosition({tile:a,x:d,y:c,animate:!0})}}))},e.moveTileToTarget=function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.animate=null!==(e=i.animate)&&void 0!==e&&e;var n=t.getSize(),s=t.getGridPosition(),a={x:this.puzzleDropzone.offsetLeft+s.x*n.width-Math.sign(s.x)*n.knob/2-s.x*n.knob/2,y:this.puzzleDropzone.offsetTop+s.y*n.height-Math.sign(s.y)*n.knob/2-s.y*n.knob/2};this.setTilePosition({tile:t,x:a.x,y:a.y,animate:i.animate})},e.moveTilesToTarget=function(t){var e,i,n=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=t?t.map((function(t){return t.instance?t:{instance:t}})):this.tiles,s.animate=null===(e=s.animate)||void 0===e||e,s.finalize=null===(i=s.finalize)||void 0===i||i,t.forEach((function(t){n.moveTileToTarget(t.instance,{animate:s.animate}),s.finalize&&n.finalizeTile(t.instance)}))},e.finalizeTile=function(t){t.disable(),t.hideHint(),t.putInBackground(),this.hideTileBorders(t),t.setDone(!0)},e.incrementHintCounter=function(){this.hintsUsed++,this.titlebar.setHintsUsed(this.hintsUsed)},e.showHint=function(t){var e=this;this.stopAttentionTimer(),this.stopHintTimer(),this.titlebar.disableAudioButton(),this.titlebar.disableFullscreenButton(),this.startAudio("puzzleHint",{silence:!0,keepAlives:this.audiosToKeepAlive});var i=this.tiles.filter((function(t){return!t.instance.isDone}));i.forEach((function(t){t.instance.putInBackground()})),t&&i.some((function(e){return e.instance.getId()===t.getId()}))||(t=i[Math.floor(Math.random()*i.length)].instance),t.putOnTop();var n=t.getSize(),s=t.getGridPosition(),a=t.getPosition(),o={x:this.puzzleDropzone.offsetLeft+s.x*n.width-Math.sign(s.x)*n.knob/2-s.x*n.knob/2,y:this.puzzleDropzone.offsetTop+s.y*n.height-Math.sign(s.y)*n.knob/2-s.y*n.knob/2};this.showOverlay((function(){e.setTilePosition({tile:t,x:a.x,y:a.y,animate:!0}),e.titlebar.enableAudioButton(),e.titlebar.enableFullscreenButton(),clearTimeout(e.animateHintTimeout),e.hideOverlay(),t.hideHint(),t.enable(),e.runAttentionTimer(),e.runHintTimer(),e.callbacks.onHintDone()})),t.disable(),t.showHint(),this.animateHint({tile:t,currentPosition:a,targetPosition:o})},e.animateHint=function(){var t,e,i,n=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s.duration=null!==(t=s.duration)&&void 0!==t?t:1,s.delay=null!==(e=s.delay)&&void 0!==e?e:.75,s.toTarget=null===(i=s.toTarget)||void 0===i||i,s.toTarget?this.setTilePosition({tile:s.tile,x:s.targetPosition.x,y:s.targetPosition.y,animate:!0,duration:s.duration}):this.setTilePosition({tile:s.tile,x:s.currentPosition.x,y:s.currentPosition.y,animate:!0,duration:s.duration}),clearTimeout(this.animateHintTimeout),this.animateHintTimeout=setTimeout((function(){s.toTarget=!s.toTarget,n.animateHint(s)}),1e3*(s.duration+s.delay))},e.updatePuzzleOutlines=function(t,e){var i=e.getDOM(),n=this.puzzleOutlines[t];n.style.width=i.style.width,n.style.height=i.style.height;var s=e.getSize(),a=e.getGridPosition(),o={x:this.puzzleDropzone.offsetLeft+a.x*s.width-Math.sign(a.x)*s.knob/2-a.x*s.knob/2,y:this.puzzleDropzone.offsetTop+a.y*s.height-Math.sign(a.y)*s.knob/2-a.y*s.knob/2};if(this.puzzleOutlines[t].style.left="".concat(o.x,"px"),this.puzzleOutlines[t].style.top="".concat(o.y,"px"),!n.isConnected){if(this.puzzleDropzone.appendChild(n),e.getId()<this.params.size.width){var r=n.querySelector(".border-top");r&&r.setAttribute("stroke-opacity","0")}if(e.getId()%this.params.size.width==this.params.size.width-1){var l=n.querySelector(".border-right");l&&l.setAttribute("stroke-opacity","0")}if(this.params.size.width*(this.params.size.height-1)-1<e.getId()){var h=n.querySelector(".border-bottom");h&&h.setAttribute("stroke-opacity","0")}if(e.getId()%this.params.size.width==0){var u=n.querySelector(".border-left");u&&u.setAttribute("stroke-opacity","0")}}},e.showOverlay=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.isOverlayShowing=!0,this.overlay.clickCallback=t,this.overlay.setAttribute("tabindex",0),this.overlay.setAttribute("aria-label",this.params.a11y.close),this.overlay.addEventListener("click",this.overlay.clickCallback),this.overlay.classList.remove("disabled"),this.overlay.focus()},e.hideOverlay=function(){this.overlay.classList.add("disabled"),this.overlay.setAttribute("tabindex",-1),this.overlay.setAttribute("aria-label",""),this.overlay.removeEventListener("click",this.overlay.clickCallback),this.overlay.clickCallback=null,this.isOverlayShowing=!1},e.showTileBorders=function(t){t.setBorders({top:!0,right:!0,bottom:!0,left:!0})},e.hideTileBorders=function(t){if(t.getId()<this.params.size.width)t.setBorders({top:!1});else{var e=this.tiles[t.getId()-this.params.size.width].instance;e.isDisabled&&(t.setBorders({top:!1}),e.setBorders({bottom:!1}))}if(t.getId()%this.params.size.width==this.params.size.width-1)t.setBorders({right:!1});else{var i=this.tiles[t.getId()+1].instance;i.isDisabled&&(t.setBorders({right:!1}),i.setBorders({left:!1}))}if(this.params.size.width*(this.params.size.height-1)-1<t.getId())t.setBorders({bottom:!1});else{var n=this.tiles[t.getId()+this.params.size.width].instance;n.isDisabled&&(t.setBorders({bottom:!1}),n.setBorders({top:!1}))}if(t.getId()%this.params.size.width==0)t.setBorders({left:!1});else{var s=this.tiles[t.getId()-1].instance;s.isDisabled&&(t.setBorders({left:!1}),s.setBorders({right:!1}))}},e.getAnswerGiven=function(){return this.isAnswerGiven},e.getScore=function(){return this.tiles.reduce((function(t,e){return t+(e.instance.isDone?1:0)}),0)},e.getCurrentState=function(){var t=this;return{timeLeft:this.timeLeft,hintsUsed:this.hintsUsed,backgroundMusic:this.titlebar.getAudioButtonState(),tiles:this.tiles.map((function(e){return{isDone:e.instance.isDone,position:a.getRelativePosition(e.instance.getPosition(),t.puzzleArea)}}))}},e.handleImageLoaded=function(t){var e;this.originalSize={width:this.image.naturalWidth,height:this.image.naturalHeight};for(var i=0;i<this.params.size.height;i++)for(var n=0;n<this.params.size.width;n++)this.tiles.push({instance:this.createPuzzleTile({x:n,y:i,format:t}),position:{x:0,y:0}});if(this.params.showBackground){var s=document.createElement("img");s.classList.add("h5p-jigsaw-puzzle-background-image"),s.setAttribute("src",this.image.src),this.puzzleDropzone.appendChild(s)}this.audios.backgroundMusic&&this.titlebar.enableAudioButton(),this.params.sound.autoplayBackgroundMusic&&!1!==this.params.previousState.backgroundMusic&&(this.titlebar.toggleAudioButton("unmute"),this.startAudio("backgroundMusic")),0===Object.keys(this.params.previousState).length||null!==(e=this.params.previousState)&&void 0!==e&&e.tiles.some((function(t){return!t.isDone}))?this.timeLeft>0&&"undefined"==typeof H5PEditor&&(this.runTimer(),this.runAttentionTimer(),this.runHintTimer()):this.titlebar.setTimeLeft(this.timeLeft),this.handleResized()},e.handleResized=function(){var t=this;if(this.originalSize){var e=(this.puzzleDropzone.offsetWidth-this.borderWidth)/this.originalSize.width,i={height:e*this.originalSize.height-this.borderWidth,width:e*this.originalSize.width-this.borderWidth};this.maxSize.height&&(this.puzzleDropzone.style.width||i.height>this.maxSize.height||i.width>this.maxSize.width)?((this.maxSize.height-this.borderWidth)/this.originalSize.height<(this.maxSize.width-this.borderWidth)/this.originalSize.width?(this.scale=(this.maxSize.height-this.borderWidth)/this.originalSize.height,this.puzzleDropzone.style.height="".concat(this.maxSize.height-2*this.borderWidth,"px"),this.puzzleDropzone.style.width="".concat(this.scale*this.originalSize.width-this.borderWidth,"px")):(this.scale=(this.maxSize.width-this.borderWidth)/this.originalSize.width,this.puzzleDropzone.style.height="".concat(this.scale*this.originalSize.height-this.borderWidth,"px"),this.puzzleDropzone.style.width="".concat(this.maxSize.width-2*this.borderWidth,"px")),this.puzzleDropzone.style.flexShrink=0):(this.scale=e,this.puzzleDropzone.style.height="".concat(i.height,"px"),this.puzzleDropzone.style.width="",this.puzzleDropzone.style.flexShrink=""),this.tiles.forEach((function(e,i){e.instance.setScale(t.scale),e.instance.setPosition({x:e.position.x*t.puzzleArea.offsetWidth+t.puzzleDropzone.offsetLeft,y:e.position.y*t.puzzleArea.offsetHeight+t.puzzleDropzone.offsetTop}),t.puzzleOutlines&&t.updatePuzzleOutlines(i,e.instance)}))}this.callbacks.onResize()},e.handlePuzzleTileMoveStarted=function(t){this.stopAttentionTimer(),this.stopHintTimer(),this.tiles.forEach((function(t){t.instance.putInBackground(),t.instance.isDisabled||t.instance.ghost()})),t.putOnTop(),t.unghost(),this.startAudio("puzzleTilePickUp",{silence:!0,keepAlives:this.audiosToKeepAlive})},e.handlePuzzleTileMoved=function(){},e.handlePuzzleTileMoveEnded=function(e){this.tiles.forEach((function(t){t.instance.unghost()}));var i=e.getPosition(),n=e.getSize(),s=e.getGridPosition();this.tiles[e.getId()].position=i;var a={x:this.puzzleDropzone.offsetLeft+s.x*n.width-Math.sign(s.x)*n.knob/2-s.x*n.knob/2,y:this.puzzleDropzone.offsetTop+s.y*n.height-Math.sign(s.y)*n.knob/2-s.y*n.knob/2},o=Math.min(n.width,n.height)*t.SLACK_FACTOR;Math.abs(i.x-a.x)<o&&Math.abs(i.y-a.y)<o?(this.setTilePosition({tile:e,x:a.x,y:a.y}),this.finalizeTile(e),this.startAudio("puzzleTileCorrect",{silence:!0,keepAlives:this.audiosToKeepAlive})):(this.setTilePosition({tile:e,x:i.x,y:i.y}),e.setDone(!1),this.startAudio("puzzleTileIncorrect",{silence:!0,keepAlives:this.audiosToKeepAlive})),this.isAnswerGiven=!0,this.callbacks.onInteracted(),this.tiles.every((function(t){return t.instance.isDone}))?this.handlePuzzleCompleted({xAPI:!0}):(this.runAttentionTimer(),this.runHintTimer()),this.callbacks.onChanged()},e.handleButtonAudioClicked=function(t){null!=t&&t.currentTarget.classList.contains("h5p-jigsaw-puzzle-button-active")?this.startAudio("backgroundMusic"):this.stopAudios()},e.handleButtonFullscreenClicked=function(){this.callbacks.onButtonFullscreenClicked()},e.handlePuzzleCompleted=function(t){this.stopOverlayShowing(),clearTimeout(this.timer),this.stopAttentionTimer(),this.stopHintTimer(),this.startAudio("puzzleCompleted",{silence:!0,keepAlives:this.audiosToKeepAlive}),this.callbacks.onCompleted(t)},e.handlePuzzleTileCreated=function(t){var e,i,n=this,s=null===(e=this.params)||void 0===e||null===(i=e.previousState)||void 0===i?void 0:i.tiles[t.getId()];if(!0===s.isDone)this.moveTilesToTarget([t],{animate:!1,finalize:!0});else if(s.position.x&&s.position.y){var o=a.getAbsolutePosition(s.position,this.puzzleArea);this.setTilePosition({tile:t,x:o.x,y:o.y})}if(this.puzzleArea.appendChild(t.getDOM()),t.getId()+1===this.params.size.width*this.params.size.height&&this.params.showPuzzleOutlines){var r=window.getComputedStyle(this.puzzleDropzone).getPropertyValue("border-color").replace(/[^.^\d,]/g,"").split(",").map((function(t){return parseFloat(t,10)}));4===r.length?r[3]:r=[0,0,0,.1],r="rgba(".concat(r.join(","),")"),setTimeout((function(){n.puzzleOutlines=n.tiles.map((function(t){var e=t.instance.getDOM().cloneNode(!0);e.setAttribute("disabled","disabled");var i=e.querySelector("svg path");return i&&i.parentNode.removeChild(i),e.querySelectorAll("svg path").forEach((function(t){t.setAttribute("stroke",r)})),e})),n.handleResized(),n.handleAllTilesCreated()}),0)}},e.handleAllTilesCreated=function(){var t,e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;if((null===(t=this.puzzleArea)||void 0===t?void 0:t.offsetWidth)>0)this.handleDOMVisible();else{if(0===n)return void this.tiles.forEach((function(t){t.instance.show()}));this.tiles.forEach((function(t){t.instance.hide()})),clearTimeout(this.timeoutWaitForPuzzleArea),this.timeoutWaitForPuzzleArea=setTimeout((function(){e.handleAllTilesCreated(i,n-1)}),i)}},e.handleDOMVisible=function(){var t=this;this.tiles.forEach((function(t){t.instance.show()})),0===Object.keys(this.params.previousState).length&&this.moveTilesToTarget(this.tiles,{animate:!1,finalize:!1}),setTimeout((function(){0===Object.keys(t.params.previousState).length&&t.randomizeTiles({useFullArea:t.params.useFullArea,layout:t.params.randomizerPattern,keepDone:Object.keys(t.params.previousState).length>0}),t.runAttentionTimer(),t.runHintTimer(),t.startAudio("puzzleStarted"),window.requestAnimationFrame((function(){t.isPuzzleSetUp=!0,t.callbacks.onPuzzleReset(),setTimeout((function(){t.handleResized()}),250)}))}),500)},e.handleTimeUp=function(){this.handlePuzzleCompleted({xAPI:!0}),this.moveTilesToTarget()},t}();function w(t,e){return w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},w(t,e)}y.SLACK_FACTOR=.25,y.LAYOUT_STAGGERED="staggered",y.AUDIOS={puzzleDefaultSong1:u,puzzleDefaultSong2:d,puzzleDefaultSong3:c,puzzleDefaultSong4:p,puzzleStarted:m,puzzleTilePickUp:g,puzzleTileCorrect:f,puzzleTileIncorrect:b,puzzleCompleted:v,puzzleHint:z};var T=function(t){var e,i;function n(e,i){var n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(var o in(n=t.call(this,"jigsaw-puzzle")||this).params=a.extend({tilesHorizontal:4,tilesVertical:3,behaviour:{sortingSpace:50,useFullArea:!1,randomizerPattern:"random",enableComplete:!0,enableHint:!0,enableSolutionsButton:!0,enableRetry:!0,showBackground:!0,showPuzzleOutlines:!0},l10n:{complete:"Complete",hint:"Hint",tryAgain:"Retry",messageNoImage:"There was no image given for this jigsaw puzzle.",timeLimit:"time limit",shuffle:"Shuffle"},a11y:{buttonFullscreenEnter:"Enter fullscreen mode",buttonFullscreenExit:"Exit fullscreen mode",buttonAudioMute:"Mute background music",buttonAudioUnmute:"Unmute background music",complete:"Complete the puzzle. All tiles will be put to their correct position.",hint:"Receive a visual hint to where a puzzle tile needs to go.",tryAgain:"Retry the puzzle. All puzzle tiles will be shuffled on the canvas.",disabled:"Disabled",close:"Close",shuffle:"Shuffle puzzle tiles."}},e),n.params.l10n)n.params.l10n[o]=a.stripHTML(a.htmlDecode(n.params.l10n[o]));for(var r in n.params.a11y)n.params.a11y[r]=a.stripHTML(a.htmlDecode(n.params.a11y[r]));return n.contentId=i,n.extras=s,n.previousState=n.extras.previousState||{},n.uuid=H5P.createUUID(),n.params.puzzleImage&&(n.puzzleImageInstance=H5P.newRunnable(n.params.puzzleImage,n.contentId)),n.on("resize",(function(){n.handleH5PResized()})),n}i=t,(e=n).prototype=Object.create(i.prototype),e.prototype.constructor=e,w(e,i);var s=n.prototype;return s.registerDomElements=function(){var t,e,i,n,s,a,o,r,l=this;this.content=new y({attentionSeeker:this.params.behaviour.attentionSeeker,autoHintInterval:this.params.behaviour.autoHintInterval,contentId:this.contentId,imageFormat:null===(t=this.params)||void 0===t||null===(e=t.puzzleImage)||void 0===e||null===(i=e.params)||void 0===i||null===(n=i.file)||void 0===n?void 0:n.mime,previousState:this.previousState,puzzleImageInstance:this.puzzleImageInstance,randomizerPattern:this.params.behaviour.randomizerPattern,showBackground:this.params.behaviour.showBackground,showPuzzleOutlines:this.params.behaviour.showPuzzleOutlines,showHintCounter:this.params.behaviour.enableHint,size:{width:this.params.tilesHorizontal,height:this.params.tilesVertical},sortingSpace:this.params.behaviour.sortingSpace,sound:this.params.sound||{},stroke:Math.max(window.innerWidth/750,1.75),tileBorderColor:"rgba(88, 88, 88, 0.5)",timeLimit:this.params.behaviour.timeLimit||null,useFullArea:this.params.behaviour.useFullArea,uuid:this.uuid,a11y:{buttonFullscreenEnter:this.params.a11y.buttonFullscreenEnter,buttonFullscreenExit:this.params.a11y.buttonFullscreenExit,buttonAudioMute:this.params.a11y.buttonAudioMute,buttonAudioUnmute:this.params.a11y.buttonAudioUnmute,disabled:this.params.a11y.disabled,close:this.params.a11y.close},l10n:{messageNoImage:this.params.l10n.messageNoImage}},{onResize:function(){l.handleOnResize()},onCompleted:function(t){l.handlePuzzleCompleted(t)},onButtonFullscreenClicked:function(){l.toggleFullscreen()},onHintDone:function(){l.handleHintDone()},onInteracted:function(){l.handleInteracted()},onPuzzleReset:function(){l.handlePuzzleReset()},onChanged:function(){l.handleContentChanged()}}),this.setContent(this.content.getDOM()),null!==(s=this.params)&&void 0!==s&&null!==(a=s.puzzleImage)&&void 0!==a&&null!==(o=a.params)&&void 0!==o&&null!==(r=o.file)&&void 0!==r&&r.path&&(this.addButtons(),"complete"===document.readyState?window.requestAnimationFrame((function(){l.handleDOMInitialized()})):document.addEventListener("readystatechange",(function(){"complete"===document.readyState&&window.requestAnimationFrame((function(){l.handleDOMInitialized()}))})),window.addEventListener("orientationchange",(function(){H5P.isFullscreen&&setTimeout((function(){l.content.setFixedHeight(!0)}),200)}),!1))},s.addButtons=function(){var t,e,i,n,s,a,o,r,l,h,u=this;this.addButton("complete",this.params.l10n.complete,(function(){u.handleClickButtonComplete({xAPI:!0})}),this.params.behaviour.enableComplete&&(null===(t=this.previousState)||void 0===t||null===(e=t.tiles)||void 0===e?void 0:e.some((function(t){return!t.isDone}))),{"aria-label":this.params.a11y.complete},{}),this.addButton("hint",this.params.l10n.hint,(function(){u.handleClickButtonHint()}),this.params.behaviour.enableHint&&(null===(i=this.previousState)||void 0===i||null===(n=i.tiles)||void 0===n?void 0:n.some((function(t){return!t.isDone}))),{"aria-label":this.params.a11y.hint},{}),this.addButton("shuffle",this.params.l10n.shuffle,(function(){u.handleClickButtonShuffle()}),void 0===(null===(s=this.previousState)||void 0===s?void 0:s.tiles)||(null===(a=this.previousState)||void 0===a||null===(o=a.tiles)||void 0===o?void 0:o.every((function(t){return!t.isDone}))),{"aria-label":this.params.a11y.shuffle},{}),this.addButton("try-again",this.params.l10n.tryAgain,(function(){u.handleClickButtonRetry()}),this.params.behaviour.enableRetry&&!(null===(r=this.previousState)||void 0===r||!r.tiles)&&(null===(l=this.previousState)||void 0===l||null===(h=l.tiles)||void 0===h?void 0:h.some((function(t){return t.isDone}))),{"aria-label":this.params.a11y.tryAgain},{})},s.disableButtons=function(){for(var t in this.buttons)this.disableButton(t)},s.disableButton=function(t){this.buttons[t]&&(this.buttons[t].setAttribute("disabled",!0),this.buttons[t].classList.add("disabled"))},s.enableButtons=function(){for(var t in this.buttons)this.enableButton(t)},s.enableButton=function(t){this.buttons[t]&&(this.buttons[t].removeAttribute("disabled"),this.buttons[t].classList.remove("disabled"))},s.toggleFullscreen=function(t){var e=this;this.container&&("string"==typeof t&&("enter"===t?t=!1:"exit"===t&&(t=!0)),"boolean"!=typeof t&&(t=!H5P.isFullscreen),!0===t?H5P.fullScreen(H5P.jQuery(this.container),this):(H5P.exitFullScreen(),setTimeout((function(){e.trigger("resize")}),100),setTimeout((function(){e.trigger("resize")}),500)))},s.getAnswerGiven=function(){return!!this.content&&this.content.getAnswerGiven()},s.getScore=function(){return this.content?this.content.getScore():0},s.getMaxScore=function(){return this.params.tilesHorizontal*this.params.tilesVertical},s.showSolutions=function(){this.content||(this.content.stopOverlayShowing(),this.handleClickButtonComplete({xAPI:!1}),this.trigger("resize"))},s.resetTask=function(){this.params.behaviour.enableComplete&&this.showButton("complete"),this.params.behaviour.enableHint&&this.showButton("hint"),this.showButton("shuffle"),this.hideButton("try-again"),this.content&&this.content.reset(),this.handlePuzzleReset(),this.trigger("resize")},s.getXAPIData=function(){return{statement:this.getXAPIAnsweredEvent().data.statement}},s.getXAPIAnsweredEvent=function(){var t=this.createXAPIEvent("answered");return t.setScoredResult(this.getScore(),this.getMaxScore(),this,!0,this.isPassed()),t.data.statement=a.extend({result:{extensions:{"https://snordian.de/x-api/extension/time-left":a.toISO8601TimePeriod(this.content.getTimeLeft())}}},t.data.statement),t},s.getXAPIPressedEvent=function(t){var e=this.createXAPIEvent("");return e.data.statement.verb={id:"https://w3id.org/xapi/seriousgames/verbs/pressed",display:{"en-US":"pressed"}},e.data.statement.object.definition.extensions["http://id.tincanapi.com/extension/purpose"]=t,e},s.createXAPIEvent=function(t){var e=this.createXAPIEventTemplate(t);return a.extend(e.getVerifiedStatementValue(["object","definition"]),this.getxAPIDefinition()),e},s.getxAPIDefinition=function(){var t=this.getDescription();return this.params.behaviour.timeLimit&&(t="".concat(t," (").concat(this.params.l10n.timeLimit,": ").concat(a.formatTime(this.params.behaviour.timeLimit),")")),{name:{"en-US":this.getTitle()},description:{"en-US":t},type:"http://adlnet.gov/expapi/activities/cmi.interaction",interactionType:"other",extensions:{"https://snordian.de/x-api/extension/time-limit":a.toISO8601TimePeriod(this.params.behaviour.timeLimit)}}},s.isPassed=function(){return this.getScore()>=this.getMaxScore()},s.getTitle=function(){var t;return this.extras.metadata&&(t=this.extras.metadata.title),t=t||n.DEFAULT_DESCRIPTION,H5P.createTitle(t)},s.getDescription=function(){return this.params.taskDescription||n.DEFAULT_DESCRIPTION},s.getCurrentState=function(){var t,e,i,n;if(null!==(t=this.params)&&void 0!==t&&null!==(e=t.puzzleImage)&&void 0!==e&&null!==(i=e.params)&&void 0!==i&&null!==(n=i.file)&&void 0!==n&&n.path&&this.content)return this.content.getCurrentState()},s.handleDOMInitialized=function(){var t=this;this.container=a.closestParent(this.content.getDOM(),".h5p-container.h5p-jigsaw-puzzle"),this.container&&(this.content.setH5PQuestionElements(this.container),this.content.enableFullscreenButton(),this.on("enterFullScreen",(function(){setTimeout((function(){t.content.toggleFullscreen(!0)}),200)})),this.on("exitFullScreen",(function(){t.content.toggleFullscreen(!1)})),this.buttons={},this.buttons.complete=this.container.querySelector(".h5p-question-complete"),this.buttons.hint=this.container.querySelector(".h5p-question-hint"),this.buttons["try-again"]=this.container.querySelector(".h5p-question-try-again"))},s.handleH5PResized=function(){!this.bubblingUpwards&&this.content&&this.content.handleResized()},s.handleOnResize=function(){this.bubblingUpwards=!0,this.trigger("resize"),this.bubblingUpwards=!1},s.handleHintStarted=function(){this.disableButtons(),this.content.showHint()},s.handleHintDone=function(){this.enableButtons()},s.handleInteracted=function(){this.getScore()>0&&(this.showButton("try-again"),this.hideButton("shuffle")),this.triggerXAPI("interacted")},s.handlePuzzleCompleted=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.hideButton("complete"),this.hideButton("hint"),this.hideButton("shuffle"),this.showButton("try-again"),t.xAPI&&this.trigger(this.getXAPIAnsweredEvent())},s.handleClickButtonComplete=function(t){this.handleInteracted(),this.trigger(this.getXAPIPressedEvent("complete")),this.content.handlePuzzleCompleted(t),this.content.moveTilesToTarget(),this.handleContentChanged()},s.handleClickButtonHint=function(){this.trigger(this.getXAPIPressedEvent("show hint")),this.content.incrementHintCounter(),this.handleHintStarted()},s.handleClickButtonShuffle=function(){this.content.randomizeTiles({useFullArea:this.params.behaviour.useFullArea,layout:this.params.behaviour.randomizerPattern}),this.handleContentChanged()},s.handleClickButtonRetry=function(){this.resetTask()},s.handlePuzzleReset=function(){this.trigger("reset"),this.handleContentChanged()},s.handleContentChanged=function(){this.trigger("kllStoreSessionState",void 0,{bubbles:!0,external:!0})},n}(H5P.Question);T.DEFAULT_DESCRIPTION="Jigsaw Puzzle",H5P=H5P||{},H5P.JigsawPuzzleKID=T}();